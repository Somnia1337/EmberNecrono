@2024.05.30 | Week 13

改进效果：

![[Snipaste_240603_145543.png|620]]

==改进方法：分块==

改进的 rotate 函数 `rotate_block_reference()`：

```c
static void rotate_block_reference(int dim, pixel *src, pixel *dst)
{
	int block_size = 4;
	int i, j, ii, jj;
	
	for (i = 0; i < dim; i += block_size)
	{
		for (j = 0; j < dim; j += block_size)
		{
			for (ii = i; ii < i + block_size && ii < dim; ii++)
			{
				for (jj = j; jj < j + block_size && jj < dim; jj++)
				{
					COPY(&dst[PIXEL(dim - 1 - jj, ii, dim)], &src[PIXEL(ii, jj, dim)]);
				}
			}
		}
	}
}
```

改进的 smooth 函数 `smooth_block_reference()`：

```c
static void smooth_block_reference(int dim, pixel *src, pixel *dst)
{
	int block_size = 4;
	int i, j, ii, jj;
	
	for (i = 0; i < dim; i++)
	{
		COPY(&dst[PIXEL(i, 0, dim)], &src[PIXEL(i, 0, dim)]);
		COPY(&dst[PIXEL(i, dim - 1, dim)], &src[PIXEL(i, dim - 1, dim)]);
	}
	for (j = 1; j < dim - 1; j++)
	{
		COPY(&dst[PIXEL(0, j, dim)], &src[PIXEL(0, j, dim)]);
		COPY(&dst[PIXEL(dim - 1, j, dim)], &src[PIXEL(dim - 1, j, dim)]);
	}
	
	for (i = 1; i < dim - 1; i += block_size)
	{
		for (j = 1; j < dim - 1; j += block_size)
		{
			for (ii = i; ii < i + block_size && ii < dim - 1; ii++)
			{
				for (jj = j; jj < j + block_size && jj < dim - 1; jj++)
				{
					SMOOTH(&dst[PIXEL(ii, jj, dim)],
						   &src[PIXEL(ii, jj, dim)],
						   &src[PIXEL(ii - 1, jj, dim)],
						   &src[PIXEL(ii + 1, jj, dim)],
						   &src[PIXEL(ii, jj + 1, dim)],
						   &src[PIXEL(ii, jj - 1, dim)],
						   &src[PIXEL(ii - 1, jj - 1, dim)],
						   &src[PIXEL(ii + 1, jj + 1, dim)],
						   &src[PIXEL(ii - 1, jj + 1, dim)],
						   &src[PIXEL(ii + 1, jj - 1, dim)]);
				}
			}
		}
	}
}
```