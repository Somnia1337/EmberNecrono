@2024.05.30 | Week 13

卢剑歌 2022141461145

### Q1.

3M decides to make Post-Its by printing yellow squares on white pieces of paper. As part of the printing process, they need to set the CMYK (cyan, magenta, yellow, black) value for every point in the square. 3M hires you to determine the efficiency of the following algorithms on a machine with a 2048-byte direct-mapped data cache with 32-byte blocks. You are given the following definitions:

```c
struct point_color {
	int c;
	int m;
	int y;
	int k;
};

struct point_color square[16][16];
int i, j;
```

Assume the following:

- `sizeof(int) == 4`
- Square begins at memory address `0`
- The cache is initially empty
- The only memory accesses are to the entries of the array square, variables `i` and `j` are stored in registers.

Determine the cache performance of the following code:

```c
for(i = 0; i < 16; i++) {
	for(j = 0; j < 16; j++) {
		square[i][j].c = 0;
		square[i][j].m = 0;
		square[i][j].y = 1;
		square[i][j].k = 0;
	}
}
```

> [!question] A. What is the total number of writes?

$16 \times 16 \times 4 = 1024$

> [!question] B. What is the total number of writes that miss in the cache?

缓存中有 ${\large \frac{2048}{32}} = 64$ 个块，每个 `point_color` struct 占 $4 \times 4 = 16$ 字节，共 $256$ 个 struct，需要 $128$ 个块。

由于采用直接映射，每个缓存块在第二次使用时将导致缓存未命中，也就是每个结构体的第一次写操作会命中，随后的写操作会未命中。

总未命中次数为 $1024 \times {\large \frac{3}{4}} = 768$ 次。

> [!question] C. What is the miss rate?

根据 B. 问的分析，未命中率为 $\large \frac{3}{4}$。

### Q2.

Given the assumptions in Q1, determine the cache performance of the following code:

```c
for(i = 0; i < 16; i++) {
	for(j = 0; j < 16; j++) {
		square[j][i].c = 0;
		square[j][i].m = 0;
		square[j][i].y = 1;
		square[j][i].k = 0;
	}
}
```

> [!question] A. What is the total number of writes?

$16 \times 16 \times 4 = 1024$

> [!question] B. What is the total number of writes that miss in the cache?



> [!question] C. What is the miss rate?



### Q3.

Given the assumptions in Q1, determine the cache performance of the following code:

```c
for(i = 0; i < 16; i++) {
	for(j = 0; j < 16; j++) {
		square[i][j].y = 1;
	}
}

for(i = 0; i < 16; i++) {
	for(j = 0; j < 16; j++) {
		square[i][j].c = 0;
		square[i][j].m = 0;
		square[i][j].k = 0;
	}
}
```

> [!question] A. What is the total number of writes?



> [!question] B. What is the total number of writes that miss in the cache?



> [!question] C. What is the miss rate?

