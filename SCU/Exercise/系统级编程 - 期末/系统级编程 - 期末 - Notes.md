### 选择题

Consider the following fragment of C++ source code.

```cpp
string msg;
unsigned int x;
int y;
cin >> msg >> x >> y;
cout << x + y;
```

Which of the following is (are) true regarding execution of the segment?

- The input statement will always take the same amount of time to execute
- The output statement will always be executed immediately after the input statement
- If `x` and `y` are both positive, an integer greater than both will be printed

**none**

Which of the following visual C++ objects are contained within a "project"?

- Files
- Visual C++ solutions
- Flow charts

**I only**

Which of the following does a debugger do?

- Analyze the source code to find programming errors.
- Decode machine code generated by a compiler.
- Stop execution of a program.

**II and III only**

The correct sequence of GCC compilation process is **preprocessing -> compilation -> assemble -> linking**.

The preprocessor removes the **comments** from the source code.

In C, using default floating point settings, what happens when a floating-point computation results in an overflow? **A special value "infinity" is computed, testable with `_finite()`**.

Which of the following numerical operations is most likely to lead to loss of precision? **floating-point addition** (NOT multiplication)

What is the purpose of the exponent in floating point numbers? **To indicate where the decimal or binary point should be**.

Which of the following is a good reason (are good reasons) to equip the CPU with small amounts of fast memory?

- To make the design of the compiler simpler
- To make some CPU instructions smaller
- To make some CPU instructions faster

**II and III only**

Within visual C++, which of the following will reveal the value of a variable when the program is stopped at a breakpoint?

- Placing the mouse pointer over the variable name in the source file window
- Inserting a `printf()` in the program
- Typing the variable name on the "watch" window

**I and III only**

A branch instruction **sets the program counter to one of two possible values**.

A jump instruction **unconditionally sets the program counter to its operand**.

The machine code generated from source code by a compiler **does not preserve all the information given in the source code**.

The visual C++ memory window displays **the contents of memory, interpreted in one of several ways, without the associated variable names**.

Which of the following statements about alignment within C structs is true?

- Alignment may cause the allocation of unused space
- Alignment is required by all modern processors
- Alignment can help processors access data more efficiently

**I and III only**

We want the variable `factorialfunc` to hold the address of the first instruction of the following function:

```c
int factorial(int n)
{
    if (n == 1)
        return n;
    return n * factorial(n - 1);
}
```

How would we declare the variable? **`int (*factorialfunc)(int)`**

Consider the following program segment.

```c
int factorial(int *arg)
{
    int n = *arg;
    if (n == 1)
        return n;
    return n * factorial(n - 1);
}
```

When the segment is executed, the variable `n` is allocated to **many addresses none of which is known to the compiler**.

At which of the following times is an activation record created?

- When a program starts executing.
- Every time a function is invoked.
- When a variable is declared.

**I and II only**

Consider the `malloc()` function. Which one of the following sentences is correct? **The `malloc()` allocates the desired amount of memory on the heap**.

Suppose a compiler uses static storage to store all variables, function parameters, saved registers, and return addresses. Which of the following language features can this compiler support?

- Local variables.
- Function calls.
- Recursion.

**I and II only**

The key feature of implicit memory management is that memory is freed automatically. Which of the following features of C make(s) it difficult to add support for implicit memory management in C?

- Pointers are not always initialized.
- Type casting makes it impossible to know when a value could be a pointer.
- C programs can allocate memory at runtime.

**I and II only**

What is the value of an uninitialized pointer variable declared within a function? **undefined**

When executing a function `callee()`, which of the following are true regarding the value of the frame pointer?

- It marks the top of the stack frame of the function that invoked `callee()`. 
- It marks the bottom of the stack frame of `callee()`.
- It is the top of the stack.

**I and II only**

The C expression `a -> b` is equivalent to **`(*a).b`**.

In C, when a struct is freed, **no pointers within the struct are freed automatically**.

In C, `calloc()` differs from `malloc()` in that `calloc()` **sets the contents of the block to zero before returning**.

A static variable by default gets initialized to **`0`**.

Mark-and-sweep garbage collectors are called conservative if **they treat everything that looks like a pointer as a pointer**.

Which of the following statements are true?

- The worst-fit memory allocation algorithm is slower than the best-fit algorithm (on average).
- Deallocation using boundary tags is fast only when the list of free blocks is ordered according to increasing memory addresses.

**none of them**

What is TSC? **a timer mechanism of x86 platform, which is the shortname of time stamp counter**

Wall time measures **the total duration of a program's execution**.

CPU time measures **the time spent by a program executing program instructions**.

On profiling, which is/are WRONG?

- gprof is the profilling tool on linux platform
- it can be used to estimate where time is spent in the program
- it can incorporate instrumentation code to determine how much time the different parts of the program require

**none**

Which of the following manages the transfer of data between the CPU registers and the cache? **compiler**

Which of the following manages the transfer of data between the cache and main memory? **operating system**

Which of the following caches (all having the same size) will have the least number of conflict misses? **a fully associative cache**

At what time can linking happen?

- compile time
- load time
- run time

**I, II and III**

`.data` 段存已初始化的 静态变量 / 全局变量，`.bss` 存未初始化的 ~。

Which file format is used for executable object file?

- pe
- coff
- elf
- a.out

**all**

Where the field, which describes whether relocatable object file is using little endian or big endian, locates? **elf headers**

Which section is used for resolution?

- elf header
- section header tables
- `.symtab`
- `.rel.text` and `.rel.data`

**III only**

Which section is used for relocation?

- elf header
- section header tables
- `.symtab`
- `.rel.text` and `.rel.data`

**IV only**

What is right about trap?

- it is a kind of exception
- it can be used to implement system call
- it can be used to implement hard disk interrupt

**I and II only**

In ia32 or x86, the exception includes

- interrupt
- trap
- fault
- abort

**all**

In 32 or x86, which exception is used to implement demand paging

- interrupt
- trap
- fault
- abort

**III**

About process, which one is right?

- by using process, we are presented the illusion that our program appears to have exclusive use of both the processor and the memory
- process is a running program
- process is possible by the help of exception

**I, II and III**

### 解答题

- 位操作
- 栈帧
- 阿姆达尔定律
- 程序优化
- cache 命中率
- 静态链接

#### 防止缓冲区溢出攻击

- 使用安全函数 `fgets()` 和 `strncpy()`
- 对栈加一个随机偏移
- 禁止指令在栈上执行
- 设置并检查“金丝雀”标记

#### GC 算法

| 算法       | 描述                                 | 局限                |
| -------- | ---------------------------------- | ----------------- |
| **标记清扫** | 从 root 开始标记可达结点，<br>清扫无标记的结点       | GC 时暂停执行          |
| **复制**   | 交替使用两个堆，GC 时，<br>将所有可达结点复制到另一个并切换堆 | 空间利用率低            |
| **引用计数** | 维护每个结点的引用计数，<br>计数为 0 时清扫          | 额外计数开销<br>对循环引用无效 |
| **分代式**  | 对年轻代频繁回收，用复制<br>对老代降低回收频率，用标记清扫    |                   |

#### 位操作

```c
/// 交替实现位操作
// {~, |} => &
int bitAnd(int x, int y)
{
    return ~(~x | ~y);
}

// {~, &} => |
int bitOr(int x, int y)
{
    return ~(~x & ~y);
}

// {~, &} => ^
int bitXor(int x, int y)
{
    int a = ~(x & y);
    int b = ~(~x & ~y);
    return a & b;
}

/// 求常数
// return -1
int minusOne(void)
{
    return ~0;
}

// return i32::MAX
int tmax(void)
{
    return ~(1 << 31);
}

/// 操作输入
// return -x
int negate(int x)
{
    return (~x) + 1;
}

// return x == 0 ? 1 : 0
int isZero(int x)
{
    return !x;
}

// return x > 0 ? 1 : 0
int isPositive(int x)
{
    return !((x >> 31) | !x);
}

// return x == y ? 1 : 0
int isEqual(int x, int y)
{
    return !(x ^ y);
}

// return nth byte starting from least significant side
int getByte(int x, int n)
{
    return (x >> (n << 3)) & 0xFF;
}
```

#### 栈帧

```c
int f(int x)
{
	int y = x;
	
	if (x == 1)
	{
		return 1;
	}
	
	return y + f(x - 1);
}
```

```text
--------f(3)--------
0x40008884 | x = 3
0x40008880 | 返回地址
0x4000887C | old EBP
0x40008878 | y = 3
--------f(2)--------
0x40008874 | x = 2
0x40008870 | 返回地址
0x4000886C | old EBP
0x40008868 | y = 2
--------f(1)--------
0x40008864 | y = 1
```

#### 阿姆达尔定律

$$S = \frac{T_{old}}{T_{new}} = \frac{1}{(1 - \alpha) + \alpha / k}$$

#### 程序优化

- 代码移动
- 减少过程调用
- 减少不需要的内存访问
- 循环展开
- 消除公用子表达式
- 避免临时变量
- 减少内存分配
- 减少重分配，尽量重用

#### cache 命中率

#### 静态链接