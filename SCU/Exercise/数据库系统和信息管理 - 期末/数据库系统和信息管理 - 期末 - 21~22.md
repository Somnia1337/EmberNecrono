### 1. 单选

```text
1 CDBAC
6 BBACC
```

### 2. 查询

2.1

2.1.1

$$\rm \large \Pi_{User.id,\space User.name}(\sigma_{team\space =\space '锦江'}(User))$$

2.1.2

$$\rm \large \Pi_{Dev.dNo,\space dName}(\sigma_{User.name\space =\space '李四'}(User) \Join Borrow \Join Dev)$$

2.1.3

$$\rm \large \Pi_{dNo}(\sigma_{User.id\space =\space '777' \space and \space Adm.no =\space '999'}(Borrow))$$

2.1.4

$$\rm \Pi_{User.id,\space User.name}((\Pi_{Borrow.id}(Borrow \div \Pi_{Borrow.dNo}(\sigma_{Borrow.id = '888'}(Borrow)))) \Join User)$$

2.2

2.2.1

```sql
SELECT a.name
FROM Adm a
WHERE salary > 5000;
```

2.2.2

```sql
SELECT store
FROM Adm
GROUP BY store
HAVING AVG(salary) > 5000;
```

2.2.3

```sql
SELECT a1.name
FROM Adm a1
GROUP BY store
HAVING a1.salary >= ALL(
	SELECT salary
	FROM Adm a2
	WHERE a2.store = a1.store
);
```

2.2.4

```sql
SELECT d.dNo, dName
FROM Dev d
	NATURAL JOIN Borrow b
WHERE b.id = "666"
	AND date LIKE "2022-06%";
```

2.2.5

```sql
SELECT u.name
FROM User u
	NATURAL JOIN Borrow b1
WHERE b1.id NOT IN (
	SELECT b2.id
	FROM Borrow b2
	WHERE b2.no = "555"
);
```

2.2.6

```sql
SELECT u.id, u.name
FROM User u
WHERE NOT EXISTS (
	SELECT b1.dNo
	FROM Borrow b1
	WHERE b1.no = "555"
	EXCEPT
	SELECT b2.dNo
	FROM Borrow b2
	WHERE b2.id = u.id
);
```

### 3. 范式

3.1

$$\rm Athlete(id,\space name,\space birth,\space team,\space phone)$$

- $\rm id \rightarrow \{name,\space birth,\space team\}$
- $\rm team \rightarrow phone$

```text
1) 候选码: {id}
2) 范式级别: 2NF
3) 无损分解: 
```

3.2（题目对 `item` 描述不清晰）

$$\rm Shop(no,\space name,\space addr,\space owner,\space item)$$

- $\rm no \rightarrow \{name,\space owner,\space addr\}$

```text
1) 候选码: {no}
2) 范式级别: 3NF
3) 无损分解: 无需
```

3.3

```text
1) 候选码: {A, B}, {A, C}
2) 范式级别: 3NF
3) 无损分解: 无需
```

### 4. 事务

4.1

```text
1) 是冲突可串行化的, 等效于 T2,T1 的顺序
2)
    1 <T1-Start>
    3 <T2-Start>
    5 <T1, C, 100, 95>
    6 <T2, B, 100, 90>
    9 <T2, A, 100, 98>
   11 <T2-Commit>
   13 <T1, A, 98, 49>
   14 <T1-Commit>
1) 恢复后: A = 98, B = 90, C = 100
```

### 5. 设计

5.1.1

![[数据库系统和信息管理 - 期末 - ER 图_1.png|400]]

5.1.2

$$
\begin{flalign}
&\ \rm Patient(\underline{id},\space ward\_no,\space doctor\_no,\space name,\space age,\space gender),\space FK = ward\_no,\space doctor\_no & \\
&\ \rm Nurse(\underline{nurse\_no},\space name) & \\
&\ \rm Doctor(\underline{doctor\_no},\space name) & \\
&\ \rm Ward(\underline{ward\_no},\space capacity) & \\
&\ \rm N\_W(\underline{nurse\_no},\space \underline{ward\_no}),\space FK = nurse\_no,\space ward\_no &
\end{flalign}
$$

5.1.3

```sql
SELECT p.name, age
FROM Patient p
	NATURAL JOIN N_W nw
	NATURAL JOIN Nurse n
WHERE n.name = "Emily"
	AND n.ward_no = nw.ward_no;
```