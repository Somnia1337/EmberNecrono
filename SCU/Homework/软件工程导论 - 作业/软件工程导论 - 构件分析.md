@2024.05.09 | Week 11

我最近使用 Rust 开发了一个邮件用户代理软件，节选其中的 3 个构件如下：

```rust
/// Reads user input from command line, with a customized prompt.
pub fn read_input(prompt: &str) -> String {
    print!("{}", prompt);
    io::stdout().flush().expect("failed to flush stdout");
	
    let mut input = String::new();
    io::stdin()
        .read_line(&mut input)
        .expect("failed to read input");
	
    input.trim().to_owned()
}
```

```rust
/// Connects to the SMTP server.
///
/// # Returns
///
/// - An `SmtpTransport` if the connection succeeds.
/// - An `Err` if the connection fails.
fn connect_smtp(&self) -> Result<SmtpTransport, Box<dyn Error>> {
	// Open a remote connection to server
	let smtp_cli = SmtpTransport::relay(self.smtp_domain.as_str())
		.unwrap()
		.credentials(Credentials::new(
			self.email_addr.to_string(),
			self.password.to_string(),
		))
		.build();

	// Connectivity test & return
	match smtp_cli.test_connection() {
		Ok(_) => Ok(smtp_cli),
		Err(e) => Err(Box::new(e)),
	}
}

/// Connects to the IMAP server.
///
/// # Returns
///
/// - A `Session<Connection>` if the connection succeeds.
/// - An `Err` if the connection fails.
fn connect_imap(&self) -> imap::error::Result<Session<Connection>> {
	let domain = self.imap_domain.as_str();
	let imap_cli = imap::ClientBuilder::new(domain, 993).connect().unwrap();
	
	match imap_cli.login(&self.email_addr, &self.password) {
		Ok(session) => Ok(session),
		Err(e) => Err(e.0),
	}
}
```

```rust
/// Types whose valid values are enumerable.
pub trait EnumValues {
    /// Build a custom message representing valid values.
    fn valid_values(&self) -> String;
}

/// Represents a number (`usize`) selection, whose valid values are within a specific range.
pub struct RangeUsize {
    pub lo: usize,
    pub hi: usize,
}

impl RangeUsize {
    pub fn new(lo: usize, hi: usize) -> RangeUsize {
        RangeUsize { lo, hi }
    }
}

impl EnumValues for RangeUsize {
    fn valid_values(&self) -> String {
        format!(
            "[{}]",
            (self.lo..=self.hi)
                .map(|x| x.to_string())
                .collect::<Vec<_>>()
                .join(", ")
        )
    }
}
```

#### 13.5 分析内聚

高内聚的优点：

- **提高代码可读性**：内聚性高的模块之间耦合度低，使得代码结构更加清晰，更容易被理解和维护。
- **降低维护成本**：由于模块之间的依赖关系最小，当需要修改或扩展系统时，影响的范围相对较小，从而降低了维护成本。
- **增强可重用性**：良好的内聚性使得模块可以独立地发挥作用，可以在不同的项目中灵活应用，提高了代码的可重用性。
- **支持可扩展性**：随着需求的增加，可以通过添加新的内聚模块来轻松扩展系统的功能，而不会对原有的结构造成太大的影响。

分析构件的内聚类型：

- `read_input()`：**功能内聚**，专门读取用户输入。
- `connect_smtp()` 和 `connect_imap()`：**逻辑内聚**，必须都连接成功才能登录成功。
- trait `EnumValues` 和 struct `RangeUsize`：**数据内聚**，trait `EnumValues` 定义了一类有效值可以计数的类型，`RangeUsize` 实现这一 trait。

#### 13.6

低耦合的优点：

- **模块独立性**：低耦合意味着模块之间相互依赖性小，每个模块可以独立开发和测试，便于管理和维护。
- **易于理解和修改**：由于模块间的联系简单，开发者可以更容易地理解单个模块的功能和作用，无需关心其他模块的内部细节。
- **提高可重用性**：低耦合的模块更容易被重用在其他系统中，因为它们对其他模块的依赖较少。
- **降低风险**：当一个模块发生变化时，低耦合可以减少对其他模块的影响，从而降低整个系统出现问题的风险。
- **增强灵活性**：低耦合的系统结构更加灵活，可以更容易地适应需求变化，添加或删除模块而不会对其他部分产生过多影响。
- **有利于性能优化**：低耦合可以减少不必要的模块间交互，从而潜在地提高系统的性能。

分析构件的耦合类型：

- `read_input()`：**非直接耦合**，不依赖其他构件。
- `connect_smtp()` 和 `connect_imap()`：**逻辑耦合**，必须都连接成功才能登录成功。
- trait `EnumValues` 和 struct `RangeUsize`：**数据耦合**，trait `EnumValues` 定义了一类有效值可以计数的类型，`RangeUsize` 实现这一 trait。

<div style="page-break-after: always"></div>

#### 13.8

##### .1 一个细化的设计类

```java
class User {
	private String username;
	private String email;
	private String firstName;
	private String lastName;
	private boolean isActive;
	
	public User(String username, String email, String firstName, String lastName) {
		this.username = username;
		this.email = email;
		this.firstName = firstName;
		this.lastName = lastName;
		this.isActive = false;
	}
	
	public void setUsername(String newUsername) {}
	public void setEmail(String newEmail) {}
	public void setName(String firstName, String lastName) {}
}
```

##### .2 接口描述

```java
interface IUser {
	String getUsername();
	void setUsername(String newUsername);
	String getEmail();
	void setEmail(String newEmail);
	String getName();
	void setName(String firstName, String lastName);
}
```

<div style="page-break-after: always"></div>

##### .3 活动图

![[Snipaste_240516_090920.png|400]]

##### .4 状态图

![[Snipaste_240516_091257.png|400]]