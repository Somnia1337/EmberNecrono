### 操作系统的基本概念

#### 操作系统的特征

- **并发**：多个事件在同一时段发生。
	- *并发* 在同一时刻执行一个操作，*并行* 在同一时刻执行多个操作。
- **共享**：系统中的资源可供多个并发执行的进程共用。
	- *互斥共享*：如打印机。
	- *同时访问共享*：如磁盘。
- **虚拟**：将一个物理实体抽象为若干逻辑对应。
- **异步**：多个程序并发执行，执行顺序具有不可预知性。

#### 操作系统的目标和功能

OS 提供的接口：**命令接口**（联机命令接口 / 脱机命令接口）/ **程序接口**。

### 操作系统发展历程

![[OS-evolution.png|350]]

### 操作系统的运行环境

#### 处理器运行模式

特权指令和非特权指令：

- **特权指令**：不允许用户直接使用的指令，有 I/O 指令 / 关中断指令 / 内存清零指令 / 存取用于内存保护的寄存器的指令 / 送 `PSW` 到程序状态字寄存器的指令等。
- **非特权指令**：允许用户直接使用的指令，仅限访问用户的地址空间，不能直接访问系统软硬件资源，防止用户程序破坏系统。

CPU 的运行模式：

- **内核态**：可以执行特权指令（=> 切换用户态的指令是特权的）。
- **用户态**：只能执行非特权指令（=> 切换内核态的指令是非特权的）。

引发切换内核态的事件：

- 系统调用
- 发生中断
- 用户程序出错
- 用户程序试图执行特权指令

#### 中断和异常的概念

发生中断或异常时，处于用户态的 CPU 立即切换内核态（硬件实现）。

#### 系统调用

系统调用的功能：设备管理 / 文件管理 / 进程控制 / 进程通信 / 内存管理。

> [!example] 系统调用的处理
> 
> 1. 将系统调用号和所需的参数压栈，调用实际的调用指令，执行陷入指令，CPU 切换内核态，保护被中断进程的现场。
> 2. 分析系统调用类型，执行相应的系统调用处理子程序。
> 3. 恢复被中断的进程的现场，返回继续执行。

### 操作系统结构

- **分层法**：将 OS 分为若干层，每层只能调用紧邻它的低层的功能和服务。
	- 👍 便于调试 / 可扩展 / 可维护
	- 👎 灵活性差 / 低效
- **模块化**：将 OS 按功能划分为若干具有一定独立性的模块，每个模块具有某方面的管理功能，各模块通过接口通信。
	- 👍 可维护 / 可适应
	- 👎 接口混乱
- **宏内核**：将 OS 的主要功能模块作为一个紧密联系的整体运行在核心态，为用户程序提供高性能的系统服务。
	- 👍 高效
	- 👎 庞杂
- **微内核**：将内核中最基本的功能保留在内核，将不需要在核心态执行的功能移到用户态执行，降低内核的设计复杂性。移出内核的 OS 代码根据分层的原则被划分成若干服务程序，相互独立，借助微内核通信。
	- 👍 可扩展 / 可靠 / 可移植
	- 👎 性能差于宏内核

### 操作系统引导

> [!example] OS 的引导
> 
> 1. 激活 CPU，执行 BIOS。
> 2. BIOS 构建中断向量表，通电自检。
> 3. 加载带有 OS 的硬盘。
> 4. 加载主引导记录(MBR)。
> 5. 加载硬盘活动分区。
> 6. 加载分区引导记录(PBR)。
> 7. 加载启动管理器。
> 8. 加载 OS。

### 虚拟机

- **第一类虚拟机管理程序**：直接运行在裸机上，相当于 OS。
- **第二类虚拟机管理程序**：运行在宿主 OS 上，相当于一个用户程序。

![[OS-virtual_machine.png|450]]
