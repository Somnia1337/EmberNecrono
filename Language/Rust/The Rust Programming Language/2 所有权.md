ğŸ‘ˆ [[1 åŸºç¡€]]

å­˜å‚¨ç»“æ„â€”â€”æ ˆä¸å †ï¼š

- å †ï¼šåœ¨å†…å­˜ä¸­ï¼Œå­˜æ”¾å¤§å°ä¸å›ºå®šçš„æ•°æ®ã€‚
- æ ˆï¼šåœ¨é«˜é€Ÿç¼“å­˜ä¸­ï¼Œå­˜æ”¾å¤§å°å›ºå®šçš„æ•°æ®ï¼ˆåŒ…æ‹¬æŒ‡å‘å †æ•°æ®çš„æŒ‡é’ˆï¼‰ã€‚

æ‰€æœ‰æƒåŸåˆ™ï¼š

- æ¯ä¸€ä¸ªå€¼è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œå˜é‡ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…ã€‚
- æ¯ä¸€ä¸ªå€¼åœ¨åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ã€‚
- å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œå±äºå®ƒçš„å€¼å°†è¢«ä¸¢å¼ƒã€‚

`&str`ï¼šä¸å¯å˜çš„å­—ç¬¦ä¸²å­—é¢é‡ã€‚

```rust
let s1: &str = "Rust";
```

`String`ï¼šåŠ¨æ€çš„ã€å¯å˜çš„å­—ç¬¦ä¸²ã€‚

```rust
let s2: String = String::from("Rust");

let mut s = String::from("Rust");
s.push_str(", world!"); // å‘ String è¿½åŠ  &str
```

`String` ç”± 3 éƒ¨åˆ†ç»„æˆï¼šæŒ‡å‘å­˜æ”¾å­—ç¬¦ä¸²å†…å®¹å†…å­˜çš„æŒ‡é’ˆï¼Œé•¿åº¦ï¼Œå®¹é‡ã€‚è¿™ 3 éƒ¨åˆ†éƒ½å­˜å‚¨åœ¨æ ˆä¸Šï¼Œè€Œå…¶å…·ä½“å†…å®¹å­˜å‚¨åœ¨å †ä¸Šã€‚

![[String çš„å­˜å‚¨å½¢å¼.svg|400]]

ç°åœ¨ï¼Œæ‰§è¡Œ `s1 = s2`ï¼Œæ­¤æ—¶ Rust æœ‰ 3 ç§é€‰æ‹©ï¼š

- æµ…æ‹·è´ï¼šå°† `s1` çš„æ ˆä¸Šä¿¡æ¯æ‹·è´ç»™ `s2`ã€‚

![[String æµ…æ‹·è´.svg|400]]

å¦‚æœè¿™æ ·åšï¼Œå½“ `s1` å’Œ `s2` ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œå®ƒä»¬å°è¯•é‡Šæ”¾åŒä¸€å—å†…å­˜ï¼Œå±äº **äºŒæ¬¡é‡Šæ”¾**ï¼ˆdouble freeï¼‰é”™è¯¯ï¼Œæ˜¯ä¸€ä¸ªå†…å­˜å®‰å…¨æ€§ bugã€‚

- æ·±æ‹·è´ï¼šåŒæ—¶æ‹·è´ `s1` çš„æ ˆã€å †ä¿¡æ¯ç»™ `s2`ã€‚

![[String æ·±æ‹·è´.svg|400]]

åœ¨å †ä¸Šæ•°æ®æ¯”è¾ƒå¤§æ—¶ï¼Œä¼šå¯¹è¿è¡Œæ—¶æ€§èƒ½é€ æˆå¾ˆå¤§å½±å“ã€‚

- ç§»åŠ¨ï¼ˆmoveï¼‰ï¼šæ‰§è¡Œ `s2 = s1` åï¼Œä½¿ `s1` å¤±æ•ˆã€‚è¿™ä¹Ÿæ˜¯ Rust å®é™…é‡‡ç”¨çš„æ–¹å¼ã€‚

![[String ç§»åŠ¨.svg|400]]

æ‹·è´ï¼š

æ•´æ•°ä¸ºåŸºæœ¬æ•°æ®ç±»å‹ï¼Œå¤§å°å›ºå®šï¼Œå­˜å‚¨åœ¨æ ˆå†…ï¼Œé€šè¿‡è‡ªåŠ¨æ‹·è´ï¼ˆæµ…æ‹·è´ï¼‰çš„æ–¹å¼èµ‹å€¼ã€‚

```rust
let x = 5; // å°†å€¼ 5 ç»‘å®šåˆ°å˜é‡ x
let y = x; // å°† x çš„å€¼æ‹·è´, èµ‹ç»™å˜é‡ y
// x ä»æœ‰æ•ˆ
```

`String` ä¸ºå¤æ‚ç±»å‹ï¼Œç”±æ ˆå†…æŒ‡é’ˆã€å­—ç¬¦ä¸²é•¿åº¦ï¼ˆå·²ç”¨å¤§å°ï¼‰ã€å­—ç¬¦ä¸²å®¹é‡ï¼ˆåˆ†é…å¤§å°ï¼‰å…±åŒç»„æˆï¼Œå¤§å°ä¸å›ºå®šï¼Œå­˜å‚¨åœ¨å †å†…ï¼Œæ— æ³•è‡ªåŠ¨æ‹·è´ã€‚

```rust
let x = String::from("Rust"); // å°† String::from åˆ›å»ºçš„å€¼èµ‹ç»™å˜é‡ x
let y = x; // æ‰€æœ‰æƒè½¬ç§»
// x å·²å¤±æ•ˆ
```

æ‰§è¡Œ `let y = x` åï¼Œ`x` ä¸å†æœ‰æ•ˆï¼Œå¯¹å…¶å€¼çš„æ‰€æœ‰æƒè½¬ç§»ç»™ `y`ã€‚

```rust
let x: &str = "Rust"; // å˜é‡ x å¼•ç”¨å­—ç¬¦ä¸²å­—é¢é‡
let y = x; // x çš„å¼•ç”¨å€¼æµ…æ‹·è´èµ‹ç»™ y
// x ä»æœ‰æ•ˆ
```

å‰ä¸€æ®µä¸­ï¼Œ`x` æŒæœ‰äº†é€šè¿‡ `String::from` è°ƒç”¨åˆ›å»ºçš„ `String` å€¼çš„æ‰€æœ‰æƒï¼Œè€Œæ­¤å¤„ï¼Œ`x` åªæ˜¯å¼•ç”¨äº†å­—ç¬¦ä¸²å­—é¢é‡ `"Rust"`ï¼Œå¹¶ä¸å¯¹è¯¥å€¼æŒæœ‰æ‰€æœ‰æƒã€‚

`clone()`ï¼šåˆ›å»ºæ•°æ®çš„æ·±æ‹·è´ï¼Œå°†å¤§å¹…å½±å“æ€§èƒ½ã€‚

```rust
let x = String::from("Rust"); // å°† String::from åˆ›å»ºçš„å€¼èµ‹ç»™å˜é‡ x
let y = x.clone(); // å°† x çš„å€¼æ·±æ‹·è´èµ‹ç»™ y
// x ä»æœ‰æ•ˆ
```

`Copy` ç‰¹å¾ï¼šæ‹¥æœ‰ `Copy` ç‰¹å¾çš„ç±»å‹å˜é‡åœ¨è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡åä¸ä¼šå¤±æ•ˆã€‚

å…·æœ‰ `Copy` ç‰¹å¾çš„ç±»å‹ï¼š

- åŸºæœ¬ç±»å‹çš„ç»„åˆã€‚
- æ— éœ€åˆ†é…å†…å­˜çš„æˆ–æŸç§å½¢å¼èµ„æºçš„ç±»å‹ã€‚

ä¾‹å¦‚ï¼Œæ‰€æœ‰æ•´æ•°ç±»å‹ï¼Œæ‰€æœ‰æµ®ç‚¹æ•°ç±»å‹ï¼Œå¸ƒå°”ç±»å‹ï¼Œå­—ç¬¦ç±»å‹ï¼Œå…ƒç»„ï¼Œä¸å¯å˜å¼•ç”¨ `&T`ã€‚

ä½œç”¨åŸŸï¼š

```rust
fn main() {
	let s = String::from("Rust"); // s çš„ä½œç”¨åŸŸå¼€å§‹
	takes_ownership(s); // s ç§»åŠ¨åˆ°æ–¹æ³•å†…
	// s å·²å¤±æ•ˆ
	
	let a = 5; // a çš„ä½œç”¨åŸŸå¼€å§‹
	makes_copy(a); // a ç§»åŠ¨åˆ°æ–¹æ³•å†…
	// a ä»æœ‰æ•ˆ
}

fn takes_ownership(x: String) {
	println!("{x}");
} // x ç§»å‡ºä½œç”¨åŸŸ, è°ƒç”¨ drop(), å†…å­˜é‡Šæ”¾

fn makes_copy(x: i32) {
	println!("{x}");
} // x ç§»å‡ºä½œç”¨åŸŸ, æ— å…¶ä»–æ“ä½œ
```

è¦åœ¨è°ƒç”¨ `takes_ownership()` åç»§ç»­ä½¿ç”¨ `s`ï¼Œåªéœ€æ”¹ä¸ºä¼ å…¥ `s.clone()`ï¼š

```rust
fn main() {
	let s = String::from("Rust");
	takes_ownership(s.clone()); // æ”¹ä¸ºä¼ å…¥ s.clone()
	// s ä»æœ‰æ•ˆ
}
```

æ›´å¤šç¤ºä¾‹ï¼š

```rust
fn main() {
	let s1 = gives_ownership(); // s1 çš„ä½œç”¨åŸŸå¼€å§‹
	let s2 = String::from("Rust"); // s2 çš„ä½œç”¨åŸŸå¼€å§‹
	let s3 = takes_and_gives_back(s2); // s2 ç§»åŠ¨åˆ°æ–¹æ³•å†…, æ–¹æ³•çš„è¿”å›å€¼è½¬ç§»ç»™ s3
	// s1 ä»æœ‰æ•ˆ, s2 å·²å¤±æ•ˆ, s3 ä»æœ‰æ•ˆ
}

// å°†è¿”å›å€¼è½¬ç§»ç»™è°ƒç”¨è€…
fn gives_ownership() -> String {
	let x = String::from("Hello");
	x
}

// æ¥æ”¶ä¸€ä¸ªå€¼, æ¥ç€è½¬ç§»å›è°ƒç”¨è€…
fn takes_and_gives_back(x: String) -> String {
	x
}
```

å¼•ç”¨ï¼š

```rust
fn main() {
	let x = 5; // x çš„ç±»å‹ä¸º i32
	let y = &x; // y çš„ç±»å‹ä¸º &i32, å¯¹ i32 çš„å¼•ç”¨
	assert_eq!(5, x); // success
	assert_eq!(5, *y); // è§£å¼•ç”¨ y, å¾—åˆ° i32 å€¼ 5 // success
}
```

ä¼ å…¥å¼•ç”¨ä¸ä¼šè½¬ç§»æ‰€æœ‰æƒï¼š

```rust
fn main() {
    let s = String::from("Rust");
    let n = get_len(&s);
    // s ä»æœ‰æ•ˆ
}

fn get_len(s: &String) -> usize {
    s.len()
}
```

å¼•ç”¨æŒ‡å‘çš„å€¼é»˜è®¤ä¸å¯å˜ï¼š

```rust
fn main() {
	let s = String::from("Hello");
	change(&s);
}

fn change(s: &String) {
	s.push_str(", Rust!"); // error
}
```

æ”¹ä¸ºå¯å˜å¼•ç”¨åˆ™å¯ä¿®æ”¹ï¼š

```rust
fn main() {
	let mut s = String::from("Hello"); // æ”¹ä¸ºå¯å˜
	change(&mut s); // æ”¹ä¸ºä¼ å…¥å¯å˜å¼•ç”¨
}

fn change(s: &mut String) { // æ”¹ä¸ºæ¥æ”¶å¯å˜å¼•ç”¨
	s.push_str(", Rust!"); // ok
}
```

å¼•ç”¨çš„ä½œç”¨åŸŸçš„ç»“æŸä½ç½®ï¼šæœ€åä¸€æ¬¡ä½¿ç”¨çš„è¡Œã€‚

åœ¨åŒä¸€ä½œç”¨åŸŸï¼Œä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªå¯å˜å¼•ç”¨ï¼š

```rust
// not ok
fn main() {
	let mut s = String::from("Rust");
	let r1 = &mut s;
	let r2 = &mut s; // error: æ— æ³•åŒæ—¶å¯¹ s è¿›è¡Œ 2 æ¬¡å¯å˜å€Ÿç”¨
	println!("{r1}, {r2}"); // r1 çš„æœ€åä¸€æ¬¡ä½¿ç”¨
}
```

```rust
// ok
fn main() {
    let mut s = String::from("Rust");
    let r1 = &mut s;
    print!("{r1}"); // r1 çš„æœ€åä¸€æ¬¡ä½¿ç”¨, r1 çš„ä½œç”¨åŸŸåœ¨æ­¤ç»“æŸ
    let r2 = &mut s; // ä¹‹å, å¯ä»¥åˆ›å»º r2
    print!("{r2}");
}
```

```rust
// not ok
fn main() {
    let mut s = String::from("Rust");
    let r1 = &mut s;
    print!("{}", r1);
    let r2 = &mut s;
    print!("{r2}");
    print!("{r1}"); // åŠ ä¸Šæ­¤è¡Œåå‡ºé”™, å› ä¸ºå®ƒå»¶é•¿äº† r1 çš„ä½œç”¨åŸŸ, å¯¼è‡´ s2 å’Œ s1 åŒæ—¶å­˜åœ¨
}
```

```rust
// ok
fn main() {
    let mut s = String::from("Rust");
    let _r1 = &mut s; // r1 çš„ä½œç”¨åŸŸåœ¨æ­¤ç»“æŸ
    let r2 = &mut s;
    print!("{r2}");
}
```

å¯å˜å¼•ç”¨ä¸ä¸å¯å˜å¼•ç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨ï¼š

```rust
fn main() {
    let mut s = String::from("Rust");
    let r1 = &s; // ok
    let r2 = &s; // ok
    let r3 = &mut s; // error
}
```

æ‚¬å‚å¼•ç”¨(dangling references)ï¼šå¼•ç”¨æœªé‡Šæ”¾ï¼Œä½†å…¶å¼•ç”¨çš„å˜é‡å·²ç»é‡Šæ”¾ã€‚

```rust
fn main() {
    let ref_to_nothing = dangle();
}

fn dangle() -> &String {           // dangle() è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼•ç”¨
    let s = String::from("hello"); // s æ˜¯ä¸€ä¸ªæ–°å­—ç¬¦ä¸²
    &s                             // è¿”å›å­—ç¬¦ä¸² s çš„å¼•ç”¨
} // è¿™é‡Œ s ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒ, å…¶å†…å­˜è¢«é‡Šæ”¾
  // å±é™©!
```

æ‚¬å‚æŒ‡é’ˆå’Œé‡æŒ‡é’ˆçš„åŒºåˆ«ï¼š

- æ‚¬å‚æŒ‡é’ˆï¼šæ›¾ç»æœ‰æ•ˆï¼Œç°åœ¨å¤±æ•ˆã€‚
- é‡æŒ‡é’ˆï¼šä»æœªæœ‰æ•ˆè¿‡ã€‚

å¼•ç”¨çš„æ€»è§„åˆ™ï¼š

- åœ¨ä»»æ„ç»™å®šæ—¶é—´ï¼Œ**è¦ä¹ˆ** åªèƒ½æœ‰ **ä¸€ä¸ª** å¯å˜å¼•ç”¨ï¼Œ**è¦ä¹ˆ** åªèƒ½æœ‰å¤šä¸ª **ä¸å¯å˜** å¼•ç”¨ã€‚
- å¼•ç”¨å¿…é¡»æ€»æ˜¯æœ‰æ•ˆçš„ã€‚

ç»ƒä¹ ï¼š

1. 

```rust
fn main() {
    // ä½¿ç”¨å°½å¯èƒ½å¤šçš„æ–¹æ³•è¿‡ç¼–
    let x = String::from("Hello, Rust!");
    let y = x;
    println!("{x}, {y}");
}
```

ç­”æ¡ˆï¼š

```rust
fn main() {
    let x = String::from("Hello, Rust!");
    let y = x.clone(); // clone()
    println!("{x}, {y}");
}
```

```rust
fn main() {
    let x = "Hello, Rust!"; // æ”¹ä¸ºå­—é¢é‡
    let y = x;
    println!("{x}, {y}");
}
```

```rust
fn main() {
    let x = &String::from("Hello, Rust!"); // æ”¹ä¸ºå¼•ç”¨
    let y = x;
    println!("{x}, {y}");
}
```

```rust
fn main() {
    let x = String::from("Hello, Rust!");
    let y = x.as_str(); // åˆ›å»ºæ–°å˜é‡
    println!("{x}, {y}");
}
```

2. 

```rust
// å°† clone() æ”¹ä¸º copy
fn main() {
    let x = (1, 2, (), "Rust".to_string());
    let y = x.clone();
    println!("{x:?}, {y:?}");
}
```

ç­”æ¡ˆï¼š

```rust
fn main() {
    let x = (1, 2, (), "Rust"); // æ”¹ä¸ºå­—ç¬¦ä¸²å­—é¢é‡
    let y = x;
    println!("{x:?}, {y:?}");
}
```

ğŸ‘‰ [[3 å¤åˆç±»å‹]]