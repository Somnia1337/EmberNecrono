ğŸ‘ˆ [[6 æ–¹æ³•]]

## æ³›å‹

å¤šæ€ï¼šå¤šæ€å°±åƒä¸€ä¸ªé€šç”¨ç‚®ç®¡ï¼Œæ—¢å¯ä»¥å‘å°„æ™®é€šç‚®å¼¹ï¼Œä¹Ÿå¯ä»¥å‘å°„åˆ¶å¯¼ç‚®å¼¹ï¼Œæ²¡æœ‰å¿…è¦ä¸ºæ¯ä¸€ç§ç‚®å¼¹è®¾è®¡ä¸€ä¸ªä¸“ç”¨ç‚®ç®¡ã€‚

æ³›å‹ï¼šæ³›å‹å°±æ˜¯ä¸€ç§å¤šæ€ï¼Œç›®çš„åœ¨äºæä¾›ç¼–ç¨‹çš„ä¾¿åˆ©ï¼Œç®€åŒ–ä»£ç ã€‚

```rust
fn add<T>(a: T, b: T) -> T {
    a + b
}

fn main() {
    println!("add i8: {}", add(2i8, 3i8));
    println!("add i32: {}", add(20, 30));
    println!("add f64: {}", add(1.23, 1.23));
}
```

å®ƒæ— æ³•è¿‡ç¼–ï¼Œåªæ˜¯ä¸ºäº†å±•ç¤ºæ³›å‹çš„æ¦‚å¿µã€‚

`T` ä¸ºæ³›å‹å‚æ•°ï¼Œåç§°ä»»æ„ï¼ŒæŒ‰æƒ¯ä¾‹å– `type` çš„é¦–å­—æ¯ `T`ã€‚

åœ¨ä½¿ç”¨æ³›å‹å‚æ•°å‰ï¼Œéœ€è¦å…ˆå£°æ˜ï¼š

```rust
fn largest<T>(list: &[T]) -> T
```

è¿™æ˜¯ä¸€ä¸ªæ³›å‹å‡½æ•°çš„ç­¾åï¼Œå…¶ä½œç”¨ä¸ºä»å…ƒç´ ç±»å‹ä¸º `T` çš„åˆ—è¡¨ä¸­æ‰¾åˆ°æœ€å¤§çš„å€¼ã€‚`<T>` æ˜¯å¯¹ `T` çš„å£°æ˜ã€‚

```rust
// not ok
fn largest<T>(list: &[T]) -> T {
    let mut largest = list[0];
	
    for &item in list.iter() {
        if item > largest {
            largest = item;
        }
    }
	
    largest
}
```

è¿™æ˜¯ä¸€ä¸ªé”™è¯¯çš„å®ç°ï¼Œç¼–è¯‘å™¨æç¤ºè¿ç®—ç¬¦ `>` ä¸èƒ½ç”¨äºç±»å‹ `T`ï¼Œå¹¶å»ºè®®ä¸º `T` æ·»åŠ ä¸€ä¸ªç±»å‹é™åˆ¶ï¼Œä½¿ç”¨ `std::cmp::PartialOrd` ç‰¹å¾å¯¹ `T` è¿›è¡Œé™åˆ¶ï¼Œè¯¥ç‰¹å¾çš„ç›®çš„åœ¨äºè®©ç±»å‹å®ç°å¯æ¯”è¾ƒçš„åŠŸèƒ½ã€‚

```rust
// ok
fn largest<T: std::cmp::PartialOrd>(list: &[T]) -> T {
    let mut largest = list[0];
	
    for &item in list.iter() {
        if item > largest {
            largest = item;
        }
    }
	
    largest
}
```

è¿™æ ·ä¿®æ”¹å°±å¯ä»¥è¿‡ç¼–äº†ã€‚

å¯¹äºæœ€åˆçš„ `a + b`ï¼Œè¯¥æ³›å‹ `T` éœ€å®ç° `std::ops::Add<Output = T>` è¿›è¡Œé™åˆ¶ã€‚

```rust
// ok
fn add<T: std::ops::Add<Output = T>>(a:T, b:T) -> T {
    a + b
}
```

### æ³›å‹çš„ä½¿ç”¨

#### åœ¨ç»“æ„ä½“ä¸­ä½¿ç”¨æ³›å‹

```rust
struct Point<T> {
    x: T,
    y: T,
}
```

ç»“æ„ä½“ `Point` å®šä¹‰äº†ä¸€ä¸ªåæ ‡ç‚¹ï¼Œå¯ä»¥å­˜æ”¾ä»»ä½•ç±»å‹çš„åæ ‡å€¼ï¼š

```rust
fn main() {
    let integer = Point { x: 5, y: 10 };
    let float = Point { x: 1.0, y: 4.0 };
}
```

ä½¿ç”¨è¯´æ˜ï¼š

- ç±»ä¼¼äºæ³›å‹å‡½æ•°çš„å®šä¹‰ï¼Œåœ¨ä½¿ç”¨æ³›å‹å‚æ•°å‰éœ€è¦å…ˆå£°æ˜ï¼Œç„¶åæ‰èƒ½ç”¨ `T` ä»£æ›¿å…·ä½“çš„ç±»å‹ã€‚
- åˆ›å»º `Point` å®ä¾‹æ—¶ï¼ŒåŒä¸€ä¸ªç‚¹çš„ `x` å’Œ `y` å¿…é¡»ç±»å‹ç›¸åŒã€‚

```rust
// not ok
let p = Point{ x: 1, y: 2.0 }; // err: mismatched types
```

å½“æŠŠ `1` èµ‹ç»™ `x` æ—¶ï¼Œ`T` çš„ç±»å‹å°±ç¡®å®šä¸º `i32`ï¼Œéšå `y` å´æ¥æ”¶äº†ä¸€ä¸ª `f32` çš„å€¼ï¼Œå› æ­¤å‡ºç°é”™è¯¯ã€‚

å¦‚æœå¸Œæœ› `x` ä¸ `y` æ—¢èƒ½å¤Ÿç±»å‹ç›¸åŒã€åˆèƒ½å¤Ÿç±»å‹ä¸åŒï¼Œéœ€è¦ä½¿ç”¨ä¸¤ç§æ³›å‹å‚æ•°ï¼š

```rust
// ok
struct Point<T, U>  {
	x: T,
	y: U,
}

fn main() {
	let p = Point{ x: 1, y: 2.0 };
}
```

éœ€è¦é¿å…æ³›å‹çš„æ»¥ç”¨ï¼Œå¦‚æœå£°æ˜äº†ä¸€ä¸ª `struct Foo<T, U, V, W, X>`ï¼Œå°±è¦è€ƒè™‘æ‹†åˆ†ç»“æ„ä½“äº†ã€‚

#### åœ¨æšä¸¾ä¸­ä½¿ç”¨æ³›å‹

ä¹‹å‰å¤šæ¬¡å‡ºç°çš„ `Option` ç”¨äºæšä¸¾ä¸€ä¸ªå€¼å­˜åœ¨ä¸å¦ï¼š

```rust
enum Option<T> {
	Some(T),
	None,
}
```

ä¸ä¹‹ç±»ä¼¼çš„æšä¸¾ `Result` ç”¨äºæšä¸¾ä¸€ä¸ªå€¼æ­£ç¡®ä¸å¦ï¼š

```rust
enum Result<T, E> {
    Ok(T),
    Err(E),
}
```

- å¦‚æœå‡½æ•°æ­£å¸¸è¿è¡Œï¼Œè¿”å›ä¸€ä¸ª `Ok(T)`ï¼Œ`T` ä»£è¡¨å…·ä½“çš„è¿”å›ç±»å‹ã€‚
- å¦‚æœè¿è¡Œé”™è¯¯ï¼Œè¿”å›ä¸€ä¸ª `Err(E)`ï¼Œ`E` ä»£è¡¨é”™è¯¯ç±»å‹ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæˆåŠŸæ‰“å¼€æ–‡ä»¶ï¼Œè¿”å› `Ok(std::fs::File)`ï¼Œå¦åˆ™è¿”å› `Err(std::io::Error)`ã€‚

#### åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹

```rust
struct Point<T> {
    x: T,
    y: T,
}

impl<T> Point<T> {
    fn x(&self) -> &T {
        &self.x
    }
}

fn main() {
    let p = Point { x: 5, y: 10 };
    println!("p.x = {}", p.x());
}
```

ç»“æ„ä½“ `Point` çš„å£°æ˜ä¸­å°±æœ‰æ³›å‹å‚æ•° `T`ï¼Œå…¶ `impl` å—å°±åº”å£°æ˜ä¸º `impl<T> Point<T>`ï¼Œä¸è¿‡ï¼Œå—å†…çš„æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ³›å‹ç±»ï¼š

```rust
impl<T> Point<T> {
    fn x<U>(&self) -> &U {
        &self.x
    }
}
```

### `const` æ³›å‹

`[i32; 2]` ä¸ `[i32; 3]` æ˜¯ä¸åŒçš„æ•°ç»„ç±»å‹ï¼š

```rust
fn main() {
	let arr1: [i32;2] = [1,2];
	display_array(arr); // ok
	let arr2: [i32; 3] = [1, 2, 3];
	display_array(arr); // err: mismatched types
}

fn print_array(arr: [i32; 2]) {
	println!("{:?}", arr);
}
```

ä¿®æ”¹ `print_array` ä½¿å…¶èƒ½å¤Ÿæ‰“å°ä»»æ„é•¿åº¦çš„ `i32` æ•°ç»„ï¼š

```rust
fn print_array(arr: &[i32]) { // å‚æ•°æ”¹ä¸ºæ•°ç»„åˆ‡ç‰‡, è°ƒç”¨æ—¶ä¼ å…¥å¼•ç”¨
	println!("{:?}", arr);
}
```

è¿›ä¸€æ­¥ä¿®æ”¹ï¼Œä½¿å…¶èƒ½å¤Ÿæ‰“å°ä»»æ„ç±»å‹çš„æ•°ç»„ï¼š

```rust
// é™åˆ¶ std::fmt::Debug è¡¨æ˜ T å¯ä»¥ç”¨åœ¨ println! ä¸­
fn print_array<T: std::fmt::Debug>(arr: &[T]) {
	println!("{:?}", arr);
}
```

å¼•ç”¨èƒ½æ»¡è¶³æ‰“å°ä¸å®šé•¿æ•°ç»„çš„éœ€æ±‚ï¼Œä½†å¦‚æœéœ€è¦çš„æ˜¯æ•°ç»„æœ¬èº«å‘¢ï¼Ÿ

`const` æ³›å‹æ˜¯é’ˆå¯¹å€¼çš„æ³›å‹ï¼Œå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```rust
fn print_array<T: std::fmt::Debug, const N: usize>(arr: [T; N]) {
	println!("{:?}", arr);
}
```

ç°åœ¨ï¼Œå‚æ•° `arr` çš„ç±»å‹ä¸º `[T; N]`ï¼Œ`T` æ˜¯åŸºäºç±»å‹çš„æ³›å‹å‚æ•°ï¼Œç”¨ä»¥æŒ‡ä»£ `i32`ã€`f32` ç­‰ç±»å‹ï¼›è€Œ `N` æ˜¯åŸºäºå€¼çš„æ³›å‹å‚æ•°ï¼Œç”¨ä»¥æŒ‡ä»£ `1`ã€`4` ç­‰å€¼ï¼Œåœ¨è¿™é‡ŒæŒ‡ä»£æ•°ç»„çš„é•¿åº¦ï¼Œè¿™å°±æ˜¯ `const` æ³›å‹ï¼Œå®ƒåŸºäºçš„å€¼ç±»å‹ä¸º `usize`ã€‚

### æ³›å‹çš„æ€§èƒ½

æ³›å‹ä¸ä¼šå¯¹è¿è¡Œæ—¶æ€§èƒ½äº§ç”Ÿå½±å“ï¼Œåªä¼šæ‹–æ…¢ç¼–è¯‘é€Ÿåº¦ã€å¢å¤§æ–‡ä»¶å¤§å°ã€‚

## ç‰¹å¾

åœ¨å®ç°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œå°†å…¶ä¸åº•å±‚å­˜å‚¨è§£è€¦å¾ˆé‡è¦ï¼Œä½†ä¸å¯èƒ½ä¸ºæ¯ç§æƒ…å†µå•ç‹¬å®ç°ä¸€å¥—ä»£ç ã€‚å°†æ–‡ä»¶çš„å„ç§æ“ä½œæŠ½è±¡å‡ºæ¥ï¼Œå°±æ˜¯ç‰¹å¾(trait)çš„æ¦‚å¿µï¼Œå®ƒç±»ä¼¼äºå…¶ä»–è¯­è¨€çš„â€œæ¥å£â€ã€‚

ä¹‹å‰å°±ä½¿ç”¨è¿‡ç‰¹å¾ï¼š

- `#[derive(Debug)]`ï¼Œåœ¨è‡ªå®šä¹‰çš„ç±»å‹ä¸Šè‡ªåŠ¨æ´¾ç”Ÿ `Debug` ç‰¹å¾ï¼Œä»¥ä¾¿ç”¨ `println!("{:?}", x)` æ‰“å°å‡ºæ¥ã€‚
- ä½¿ç”¨ `std::ops::Add` ç‰¹å¾é™åˆ¶æ³›å‹ `T`ï¼Œä½¿ `T` èƒ½å¤Ÿè¿›è¡ŒåŠ æ³•æ“ä½œã€‚

ç‰¹å¾å®šä¹‰äº†ä¸€ç»„å¯ä»¥è¢«å…±äº«çš„è¡Œä¸ºï¼Œåªè¦å®ç°æŸç‰¹å¾ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ç»„è¡Œä¸ºã€‚

### ç‰¹å¾çš„å®šä¹‰

å¦‚æœè‹¥å¹²ç±»å‹å…·æœ‰ç›¸åŒçš„è¡Œä¸ºï¼Œå°±å¯ä»¥å®šä¹‰ä¸€ä¸ªç‰¹å¾ï¼Œå¹¶ä¸ºè¿™äº›ç±»å‹å®ç°ã€‚

ä¾‹å¦‚ï¼Œç°åœ¨æœ‰æ–‡ç«  `Post` ä¸åšå®¢ `Blog` ä¸¤ç§å†…å®¹è½½ä½“ï¼Œè€Œæ–‡ç« çš„å†…å®¹éƒ½å¯ä»¥â€œæ€»ç»“â€ï¼Œè¿™ä¸ªâ€œæ€»ç»“â€çš„è¡Œä¸ºå°±æ˜¯å…±äº«çš„ï¼Œç”±æ­¤å¯ä»¥å®šä¹‰ç‰¹å¾ `Summary`ï¼š

```rust
pub trait Summary {
	fn summarize(&self) -> String;
}
```

- `trait`ï¼šå…³é”®å­—ï¼Œå£°æ˜ä¸€ä¸ªç‰¹å¾ã€‚
- `Summary`ï¼šç‰¹å¾åã€‚
- `summarize`ï¼šç‰¹å¾çš„æ–¹æ³•ï¼Œåªæœ‰ç­¾åï¼Œä»¥ `;` ç»“å°¾ã€‚

### ä¸ºç±»å‹å®ç°ç‰¹å¾

ä¸º `Post` ä¸ `Blog` å®ç° `Summary` ç‰¹å¾ï¼š

```rust
pub trait Summary {
	fn summarize(&self) -> String;
}

pub struct Post {
	pub title: String,
	pub author: String,
	pub content: String,
}

pub struct Blog {
	pub username: String,
	pub content: String,
}

impl Summary for Post {
	fn summarize(&self) -> String {
		format!("title: {}, author: {}", self.title, self.author)
	}
}

impl Summary for Blog {
	fn summarize(&self) -> String {
		format!("user: {}, content: {}", self.username, self.content)
	}
}
```

```rust
fn main() {
	let post = Post {
		title: "Rust Course".to_string(),
		author: "Sunface".to_string(),
		content: "Rust is the best lang!".to_string()
	};
	println!("{}", post.summarize());
	
	let blog = Blog {
		username: "Sunface".to_string(),
		content: "learn Rust!".to_string()
	};
	println!("{}", blog.summarize());
}
```

å­¤å„¿è§„åˆ™ï¼šå¦‚éœ€ä¸ºç±»å‹ `A` å®ç°ç‰¹å¾ `T`ï¼Œé‚£ä¹ˆäºŒè€…è‡³å°‘æœ‰ä¸€ä¸ªçš„å®šä¹‰ä½äºå½“å‰ä½œç”¨åŸŸå†…ã€‚

- å¯ä»¥ä¸º `Post` å®ç°æ ‡å‡†åº“ä¸­çš„ `Display` ç‰¹å¾ã€‚
- å¯ä»¥åœ¨å½“å‰åŒ…ä¸­ä¸ºæ ‡å‡†åº“çš„ `String` ç±»å‹å®ç° `Summary` ç‰¹å¾ã€‚

é»˜è®¤å®ç°ï¼šå¯ä»¥åœ¨ç‰¹å¾å®šä¹‰ä¸­ä¸ºæ–¹æ³•è¿›è¡Œé»˜è®¤å®ç°ã€‚

```rust
pub trait Summary {
	fn summarize(&self) -> String {
		String::from("This is a default impl for summarize()")
	}
}
```

ä¹‹åï¼Œä¸ºç»“æ„å®ç° `Summary` ç‰¹å¾æ—¶å¯ä»¥é€‰æ‹©æ€§åœ°é‡è½½ `summarize`ã€‚

é»˜è®¤å®ç°ä¹Ÿå¯ä»¥è°ƒç”¨ç‰¹å¾ä¸­çš„å…¶ä»–æ–¹æ³•ï¼Œè¢«è°ƒç”¨æ–¹æ³•å¯ä»¥æœ‰ã€ä¹Ÿå¯ä»¥æ²¡æœ‰é»˜è®¤å®ç°ã€‚

```rust
pub trait Summary {
	fn summarize_author(&self) -> String;
	fn summarize(&self) -> String {
		format!("author: {}", self.summarize_author())
	}
}
```

### ç‰¹å¾ä½œä¸ºå‡½æ•°å‚æ•°

```rust
pub fn notify(item: &impl Summary) {
	println!("NOTE: {}", item.summarize());
}
```

`item` çš„ç±»å‹ä¸º `impl Summary` ç±»å‹çš„ä¸å¯å˜å¼•ç”¨ï¼Œæ„ä¸ºâ€œå®ç°äº† `Summary` ç‰¹å¾â€ã€‚

`notify()` å¯ä»¥æ¥æ”¶ä»»ä½•å®ç°äº† `Summary` ç‰¹å¾çš„ç±»å‹ä½œä¸ºå‚æ•°ï¼Œä¾‹å¦‚ `Post` çš„å®ä¾‹ï¼Œå¹¶å¯ä»¥åœ¨å†…éƒ¨è°ƒç”¨ `Summary` çš„æ–¹æ³•ã€‚

**ç‰¹å¾çº¦æŸ**ï¼š`impl Trait` æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œå®Œæ•´çš„å†™æ³•ï¼š

```rust
pub fn notify<T: Summary>(item: &T) {
	println!("NOTE: {}", item.summarize());
}
```

ç‰¹å¾çº¦æŸå¯¹äºå¤æ‚çš„åœºæ™¯å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œ`notify()` ç°åœ¨æ¥æ”¶ä¸¤ä¸ª `&impl Summary` å‚æ•°ï¼š

```rust
pub fn notify(item1: &impl Summary, item2: &impl Summary)
```

å¦‚æœæˆ‘ä»¬å¸Œæœ›é™åˆ¶ `item1`ã€`item2` ä¸ºåŒä¸€å®é™…ç±»å‹ï¼ˆä¾‹å¦‚ä¸¤ä¸ª `Post` å®ä¾‹ï¼Œè€Œä¸å…è®¸ä¸€ä¸ª `Post` å®ä¾‹ä¸ä¸€ä¸ª `Blog` å®ä¾‹ï¼‰ï¼Œè¯­æ³•ç³–å°±æ— èƒ½ä¸ºåŠ›äº†ï¼Œä½†æ˜¯ç‰¹å¾çº¦æŸå°±å¯ä»¥åšåˆ°ï¼š

```rust
pub fn notify<T: Summary>(item1: &T, item2: &T)
```

æ³›å‹ `T` è¯´æ˜ `item1` ä¸ `item2` çš„ç±»å‹ç›¸åŒï¼Œ`T: Summary` è¯´æ˜ `T` éœ€è¦å®ç° `Summary` ç‰¹å¾ã€‚

**å¤šé‡çº¦æŸ**ï¼šçº¦æŸå‚æ•°å®ç°å¤šä¸ªç‰¹å¾ã€‚

```rust
pub fn notify(item: &(impl Summary + Display))
```

```rust
pub fn notify<T: Summary + Display>(item: &T)
```

`where` çº¦æŸï¼š

```rust
fn some_function<T: Display + Clone, U: Clone + Debug>(t: &T, u: &U) -> i32

// ç”¨ where å†™ä½œ

fn some_function<T, U>(t: &T, u: &U) -> i32
    where T: Display + Clone,
          U: Clone + Debug
```

### å‡½æ•°è¿”å›ä¸­çš„ `impl Trait`

é€šè¿‡ `impl Trait` æŒ‡ç¤ºå‡½æ•°è¿”å›ä¸€ä¸ªå®ç°äº† `Trait` ç‰¹å¾çš„ç±»å‹ï¼š

```rust
fn returns_summarizable() -> impl Summary {
	Blog {
		username: String::from("Sunface"),
		content: String::from("learn Rust!"),
	}
}
```

`impl Trait` è¿”å›ç±»å‹é€šå¸¸ç”¨äºå®é™…ç±»å‹æå…¶å¤æ‚çš„æƒ…å†µï¼Œå› ä¸º Rust è¦æ±‚å¿…é¡»æŒ‡æ˜æ‰€æœ‰ç±»å‹ã€‚ä¾‹å¦‚ï¼Œè¿”å›ä¸€ä¸ªè¿­ä»£å™¨æ—¶ï¼Œå…¶å…·ä½“ç±»å‹æå…¶å¤æ‚ï¼Œå°±å¯ä»¥å°†è¿”å›ç±»å‹å†™ä¸º `impl Iterator`ã€‚

ä¸è¿‡ï¼Œè¿™ç§æŠ½è±¡çš„è¿”å›ç±»å‹åªèƒ½æŒ‡ä»£ä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š

```rust
// err
fn returns_summarizable(switch: bool) -> impl Summary {
    if switch {
        Post {
            ...
        }
    } else {
        Weibo {
            ...
        }
    }
}
```

è¿™æ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º `impl Summary` ä¸å¯ä»¥æŒ‡ä»£ä¸¤ä¸ªä¸åŒçš„ç±»å‹ï¼Œç¼–è¯‘å™¨æç¤º "\`if\` and \`else\` have incompatible types"ã€‚

è¦å®ç°è¿”å›ä¸åŒçš„ç±»å‹ï¼Œéœ€ä½¿ç”¨ç‰¹å¾å¯¹è±¡ï¼ˆè§ä¸‹ä¸€ç« ï¼‰ã€‚

### ä¿®å¤ `largest()`

è¿ç®—ç¬¦ `>` æ˜¯æ ‡å‡†åº“ä¸­ç‰¹å¾ `std::cmp::PartialOrd` çš„é»˜è®¤æ–¹æ³•ï¼Œå°† `largest()` ç­¾åä¿®æ”¹ä¸ºï¼š

```rust
fn largest<T: PartialOrd>(list: &[T]) -> T
```

ä»ç„¶æ— æ³•è¿‡ç¼–ï¼Œç¼–è¯‘å™¨æç¤º `T` æ²¡æœ‰å®ç° `Copy` ç‰¹æ€§ï¼Œéœ€è¦å¢åŠ çº¦æŸï¼š

```rust
fn largest<T: PartialOrd + Copy>(list: &[T]) -> T
```

ğŸ‘‰ [[8 é›†åˆç±»å‹]]