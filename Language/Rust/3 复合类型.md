ğŸ‘ˆ [[2 æ‰€æœ‰æƒ]]

## å­—ç¬¦ä¸²

### åˆ‡ç‰‡

`s` çš„ç±»å‹ä¸º `String`ï¼Œ`s1` è‡³ `s4` ä¸º `s` çš„åˆ‡ç‰‡ï¼Œå®ƒä»¬å‡ä¸º `&str`ï¼š

```rust
let s = String::from("Rust");
let s1 = &s[..];   // "Rust"
let s2 = &s[0..3]; // "Rus"
let s3 = &s[..2];  // "Ru"
let s4 = &s[1..];  // "ust"
```

`&str` ä¸ `String` çš„è½¬åŒ–ï¼š

```rust
// &str -> String
let str0 = "Rust";
let s1 = String::from(str0);
let s2 = str0.to_string();

// String -> &str
let s0 = String::from("Rust");
let str1 = &s0;
let str2 = &s0[1..3];
let str3 = s0.as_str();
```

ç´¢å¼•è®¿é—®ï¼š`&str` ä¸ `String` å‡ä¸º UTF-8 ç¼–ç ï¼Œä¸åŒå­—ç¬¦çš„å­—èŠ‚é•¿åº¦ä¸ä¸€è‡´ï¼Œä¾‹å¦‚ `"ä¸­å›½"` çš„é•¿åº¦ä¸º 6 ä¸ªå­—èŠ‚ï¼ˆ1 ä¸ªæ±‰å­—é•¿ä¸º 3 ä¸ªå­—èŠ‚ï¼‰ï¼Œå› æ­¤ä¸èƒ½ç”¨ç´¢å¼•è®¿é—®å•ä¸ªå­—ç¬¦ã€‚

```rust
fn main() {
    let mut s = String::from("hello world");
    let word = first_word(&s);
    s.clear(); // panic!
    println!("the first word is: {}", word);
}

fn first_word(s: &String) -> &str {
    let bytes = s.as_bytes();
    for (i, &item) in bytes.iter().enumerate() {
        if item == b' ' { return &s[0..i]; }
    }
    &s[..]
}
```

æ— æ³•è¿‡ç¼–ï¼š

```text
error[E0502]: cannot borrow `s` as mutable because it is also borrowed as immutable
 --> src\main.rs:4:5
  |
3 |     let word = first_word(&s);
  |                           -- immutable borrow occurs here
4 |     s.clear();
  |     ^^^^^^^^^ mutable borrow occurs here
5 |     println!("the first word is: {}", word);
  |                                       ---- immutable borrow later used here
```

æ›´å¥½çš„å‡½æ•°ç­¾åï¼š

```rust
fn first_word(s: &str) -> &str {
```

è¿™æ ·ï¼Œ`first_word()` å¯¹ `String` å’Œ `&str` éƒ½é€‚ç”¨ã€‚

### è¿½åŠ 

```rust
let mut s = String::from("Hello");
s.push_str(", Rust"); // è¿½åŠ  &str
s.push('!'); // è¿½åŠ  char
```

### æ’å…¥

```rust
let mut s1 = String::from("ord!");
s1.insert_str(0, ", w"); // æ’å…¥ &str -> ", word!"
s1.insert(5, 'l'); // æ’å…¥ char -> ", world!"

// ä¸èƒ½åœ¨ä¸€ä¸ªå­—ç¬¦çš„ä¸­é—´æ’å…¥
let mut s2 = String::from("ä¸–");
s2.insert(1, 'ç•Œ'); // panic
s2.insert(3, 'ç•Œ'); // ok
```

### æ›¿æ¢

`replace()`ï¼šé€‚ç”¨äº `String` ä¸ `&str`ï¼Œæ¥æ”¶ç›®æ ‡å­—ç¬¦ä¸²ä¸æ›¿æ¢å­—ç¬¦ä¸²ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚

```rust
let s1 = "I like rust. We all like rust.";
let s2 = s1.replace("rust", "Rust"); // "I like Rust. We all like Rust."
```

`replacen()`ï¼šé€‚ç”¨äº `String` ä¸ `&str`ï¼Œæ¯” `replace()` å¤šä¸€ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºæ›¿æ¢çš„ä¸ªæ•°ã€‚

```rust
let s1 = "I like rust. We all like rust.";
let s2 = s1.replace("rust", "Rust", 1); // "I like Rust. We all like rust."
```

`replace_range()`ï¼šåªé€‚ç”¨äº `String`ï¼Œå°†æŒ‡å®šèŒƒå›´å†…çš„éƒ¨åˆ†æ›¿æ¢ä¸ºæ›¿æ¢å­—ç¬¦ä¸²ï¼Œç›´æ¥åœ¨åŸä¸²ä¸Šæ“ä½œã€‚

```rust
let mut s = String::from("I like rust.");
s.replace_range(7..8, "R"); // "I like Rust."
```

### åˆ é™¤

> éƒ½åªé€‚ç”¨äº `String`ã€‚

`pop()`ï¼šåˆ é™¤å¹¶è¿”å›å­—ç¬¦ä¸²å°¾å­—ç¬¦ã€‚

```rust
let mut s = String::from("Rust");
let c = s.pop(); // è¿”å› 'o', s -> "Hell"
```

`remove()`ï¼šåˆ é™¤å¹¶è¿”å›å­—ç¬¦ä¸²æŒ‡å®šä½ç½®çš„å­—ç¬¦ã€‚

`truncate()`ï¼šåˆ é™¤å­—ç¬¦ä¸²ä¸­ä»æŒ‡å®šä½ç½®å¼€å§‹åˆ°ç»“å°¾çš„å…¨éƒ¨å­—ç¬¦ã€‚

`clear()`ï¼šæ¸…ç©ºå­—ç¬¦ä¸²ã€‚

### è¿æ¥

`+ / +=`ï¼šå³ä¾§å¿…é¡»ä¸ºå­—ç¬¦ä¸²çš„åˆ‡ç‰‡å¼•ç”¨ç±»å‹ï¼Œä¸èƒ½ç›´æ¥ä¼ é€’ `String`ã€‚è¿”å›ä¸€ä¸ªæ–°ä¸²ï¼Œå› æ­¤æ— éœ€ `mut` å£°æ˜ã€‚

`format!`ï¼šç±»ä¼¼ `println!`ï¼Œæ ¼å¼åŒ–åœ°è¿æ¥å­—ç¬¦ä¸²ã€‚

## å…ƒç»„

å…ƒç»„ç”±å¤šç§ç±»å‹ç»„åˆå½¢æˆï¼Œé•¿åº¦å›ºå®šï¼Œé¡ºåºå›ºå®šã€‚

```rust
let tup: (i32, f64, u8) = (500, 6.4, 1);
```

ç”¨æ¨¡å¼åŒ¹é…è§£æ„å…ƒç»„ï¼š

```rust
let tup = (500, 6.4, 1);
let (x, y, z) = tup; // è§£æ„
println!("y = {y}"); // y = 6.4
```

ä¹Ÿå¯ä»¥ä¸è¿›è¡Œè§£æ„è€Œå•ç‹¬è®¿é—®ä¸€ä¸ªå…ƒç´ ï¼š

```rust
let tup = (500, 6.4, 1);
println!("tup.1 = {tup.1}"); // tup.1 = 6.4
```

å…ƒç»„å¯ç”¨äºå‡½æ•°è¿”å›å¤šä¸ªå€¼ï¼š

```rust
fn main() {
    let s1 = String::from("abc");
    let (s2, n) = get_len(s1);
    println!("\"{s2}\".len() = {n}"); // "abc".len() = 3
}

fn get_len(s: String) -> (String, usize) {
    let n = s.len();
    (s, n)
}
```

## ç»“æ„ä½“

ç»“æ„ä½“ç±»ä¼¼äºå…ƒç»„ï¼Œä½†å¯ä»¥ä¸ºæ¯ä¸ªå­—æ®µå‘½åã€‚

```rust
struct User {
    active: bool,
    username: String,
    sign_in_count: u64,
}

fn main() {
    // åˆ›å»ºä¸€ä¸ªå¯å˜å®ä¾‹, åˆå§‹åŒ–é¡ºåºä»»æ„
    let mut user1 = User {
        username: String::from("Somnia"),
        active: true,
        sign_in_count: 1, // "," å¯é€‰
    };
	
    // ç‚¹å·è®¿é—®
    user1.username = String::from("Somnia1337");
    println!(
        "{} signed in {} times.",
        user1.username, user1.sign_in_count
    );
	
    // è°ƒç”¨ä¸‹é¢è‡ªå®šä¹‰çš„ç®€åŒ–å®ä¾‹åŒ–æ–¹æ³•
    let user2 = build_user(String::from("Nancy"));
	
    // æ ¹æ®å·²æœ‰ç»“æ„ä½“æ–°å»ºç»“æ„ä½“
    let user3 = User {
        // å¯å˜æ€§å¯ä»¥ä¸åŒ
        active: false,
        ..user1 // è¡¨ç¤ºå…¶ä½™æˆå‘˜åŒ user1, å°¾éƒ¨ä¸èƒ½åŠ  ","
                // è¿™é‡Œ, String ç±»å‹çš„ user1.username çš„æ‰€æœ‰æƒè½¬ç§»ç»™ user3
                // å› æ­¤ user1.username å·²å¤±æ•ˆ, ä½† user1 ä»æœ‰æ•ˆ
    };
}

// ç®€åŒ–ç»“æ„ä½“çš„å®ä¾‹åŒ–
fn build_user(username: String) -> User {
    // è¿”å›ä¸€ä¸ª User å®ä¾‹
    User {
        username,
        active: true,
        sign_in_count: 1,
    }
}
```

å…ƒç»„ç»“æ„ä½“ï¼šå­—æ®µæ²¡æœ‰åç§°çš„ç»“æ„ä½“ã€‚

```rust
struct Color(i32, i32, i32);
let black = Color(0, 0, 0);
```

å•å…ƒç»“æ„ä½“ï¼šä¸å…³å¿ƒè¯¥ç±»å‹çš„å†…å®¹, åªå…³å¿ƒå…¶è¡Œä¸ºã€‚

```rust
struct AlwaysEqual;
let subject = AlwaysEqual;
impl SomeTrait for AlwaysEqual {
	// ...
}
```

å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç»“æ„ä½“ä¸­ä½¿ç”¨ `String` è€Œé `&str` è¡¨ç¤ºå­—ç¬¦ä¸²ï¼š

```rust
struct User {
    active: bool,
    username: String,
    email: String,
    sign_in_count: u64,
}
```

è¿™æ ·ï¼Œç»“æ„ä½“å®ä¾‹ç‹¬ç«‹åœ°æ‹¥æœ‰å’Œç®¡ç†è‡ªèº«çš„æ‰€æœ‰æ•°æ®ï¼Œè€Œä¸ä¾èµ–å¤–éƒ¨èµ„æºï¼Œä»è€Œï¼Œåªè¦ç»“æ„ä½“å®ä¾‹æœ‰æ•ˆï¼Œå…¶æ•°æ®å°±æœ‰æ•ˆã€‚

ç»“æ„ä½“æ›´æ–°ï¼š

```rust
let user2 = User {
	active: user1.active,
	username: user1.username,
	email: String::from("another@example.com"),
	sign_in_count: user1.sign_in_count,
};

// ç®€åŒ–ä¸º

let user2 = User {
	email: String::from("another@example.com"),
	..user1
};
```

æ›´æ–°æ—¶ï¼Œæœªå®ç° `Copy` çš„å­—æ®µä¼šè¢«è½¬ç§»ï¼Œä¸è¿‡ç»“æ„ä½“å®ä¾‹æœ¬èº«ä¸ä¼šè½¬ç§»ã€‚

åœ¨ä¸Šä¾‹ä¸­ï¼Œåˆ›å»º `user2` æ—¶é‡æ–°å®šä¹‰äº† `email` å­—æ®µï¼Œå…¶ä»–å­—æ®µç»§æ‰¿è‡ª `user1`ï¼ˆåŒ…æ‹¬æœªå®ç° `Copy` çš„ `username`ï¼‰ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œ`user1.username` ä¸å†å¯ç”¨ï¼Œä½† `user1` çš„å…¶ä½™å­—æ®µä»ç„¶å¯ç”¨ã€‚

å…ƒç»„ç»“æ„ä½“çš„åº”ç”¨åœºæ™¯ï¼šéœ€è¦ä¸ºæ•´ä¸ªå…ƒç»„ç±»å‹å‘½åï¼Œä½¿å…¶ä¸ä¸€èˆ¬çš„å…ƒç»„ç±»å‹åŒºåˆ†å¼€æ¥ï¼ˆä¾‹å¦‚ `struct Point(i32, i32)` ä¸ `(i32, i32)` æ˜¯ä¸¤ç§ç±»å‹ï¼‰ï¼Œä½†ä¸è¦æ±‚ä¸ºæ¯ä¸ªå­—æ®µå‘½åã€‚

## æšä¸¾

æ‰‘å…‹ç‰Œçš„èŠ±è‰²å¯ä»¥æšä¸¾ï¼š

```rust
enum PokerSuit {
	Clubs,
	Spades,
	Diamonds,
	Hearts,
}
```

ç”¨æ“ä½œç¬¦ `::` è®¿é—®æšä¸¾æˆå‘˜ï¼š

```rust
// åˆ›å»ºå®ä¾‹
let heart: PokerSuit = PokerSuit::Hearts;
```

æ‰‘å…‹ç‰Œè¿˜éœ€è¦æ•°å€¼ï¼š

```rust
enum PokerCard {
	Clubs(u8),
	Spades(u8),
	Diamonds(u8),
	Hearts(u8),
}
```

```rust
let card = PokerCard::Hearts(3);
```

å„ç§ç±»å‹éƒ½å¯ä»¥æ”¾åœ¨æšä¸¾ç±»å‹é‡Œï¼š

```rust
struct Ipv4Addr {
	// ...
}

struct Ipv6Addr {
	// ...
}

enum IpAddr { // åœ¨æšä¸¾ä¸­æ”¾ç»“æ„ä½“
	V4(Ipv4Addr),
	V6(Ipv6Addr),
}

enum Addr { // åœ¨æšä¸¾ä¸­æ”¾æšä¸¾
	Ip(IpAddr),
	// ...
}
```

```rust
enum IpAddr {
	V4,
	V6,
}
```

å°†å€¼å…³è”åˆ°ç±»å‹ï¼š

```rust
enum IpAddr {
	V4(String),
	V6(String),
}
```

ä»è€Œæ˜“äºä¿®æ”¹ï¼š

```rust
enum IpAddr {
	V4(u8, u8, u8, u8),
	V6(String),
}
```

æ„é€ å®ä¾‹æ—¶ï¼Œä½¿ç”¨è‡ªåŠ¨å®šä¹‰çš„ `IpAddr::V4()` ç­‰ï¼š

```rust
enum IpAddr {
	V4(u8, u8, u8, u8),
	V6(String),
}

let home = IpAddr::V4(127, 0, 0, 1);
let loopback = IpAddr::V6(String::from("::1"));
```

è¿˜å¯ä»¥å…³è”æ›´å¤šç±»å‹ï¼š

```rust
enum Message {
    Quit,                       // ä¸å…³è”
    Move { x: i32, y: i32 },    // ç»“æ„ä½“
    Write(String),              // å­—ç¬¦ä¸²
    ChangeColor(i32, i32, i32), // å…ƒç»„
}
```

è¿™å¯ä»¥ç­‰ä»·æ”¹å†™ä¸ºï¼š

```rust
struct QuitMessage; // ç±»å•å…ƒç»“æ„ä½“
struct MoveMessage { // ä¸€èˆ¬ç»“æ„ä½“
    x: i32,
    y: i32,
}
struct WriteMessage(String); // å…ƒç»„ç»“æ„ä½“
struct ChangeColorMessage(i32, i32, i32); // å…ƒç»„ç»“æ„ä½“

enum Message {
	Quit(QuitMessage),
	Move(MoveMessage),
	Write(WriteMessage),
	ChangeColor(ChangeColorMessage),
}
```

## `Option` æšä¸¾

å…¶ä»–è¯­è¨€ç”¨ `null` è¡¨ç¤ºç©ºå€¼ã€‚

> æˆ‘ç§°ä¹‹ä¸ºæˆ‘åäº¿ç¾å…ƒçš„é”™è¯¯ã€‚å½“æ—¶ï¼Œæˆ‘åœ¨ä½¿ç”¨ä¸€ä¸ªé¢å‘å¯¹è±¡è¯­è¨€è®¾è®¡ç¬¬ä¸€ä¸ªç»¼åˆæ€§çš„é¢å‘å¼•ç”¨çš„ç±»å‹ç³»ç»Ÿã€‚æˆ‘çš„ç›®æ ‡æ˜¯é€šè¿‡ç¼–è¯‘å™¨çš„è‡ªåŠ¨æ£€æŸ¥æ¥ä¿è¯æ‰€æœ‰å¼•ç”¨çš„ä½¿ç”¨éƒ½åº”è¯¥æ˜¯ç»å¯¹å®‰å…¨çš„ã€‚ä¸è¿‡åœ¨è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæˆ‘æœªèƒ½æŠµæŠ—ä½è¯±æƒ‘ï¼Œå¼•å…¥äº†ç©ºå¼•ç”¨çš„æ¦‚å¿µï¼Œå› ä¸ºå®ƒéå¸¸å®¹æ˜“å®ç°ã€‚å°±æ˜¯å› ä¸ºè¿™ä¸ªå†³ç­–ï¼Œå¼•å‘äº†æ— æ•°é”™è¯¯ã€æ¼æ´å’Œç³»ç»Ÿå´©æºƒï¼Œåœ¨ä¹‹åçš„å››åå¤šå¹´ä¸­é€ æˆäº†æ•°åäº¿ç¾å…ƒçš„è‹¦ç—›å’Œä¼¤å®³ã€‚
> 
> â€”â€”Tony Hoareï¼Œ`null`Â çš„å‘æ˜è€…

Rust æŠ›å¼ƒäº† `null`ï¼Œæ”¹ç”¨ `Option` æšä¸¾è¡¨ç¤ºç©ºå€¼ã€‚

```rust
enum Option<T> {
	Some(T),
	None,
}
```

æˆå‘˜ `Some(T)` è¡¨ç¤ºå«æœ‰å€¼ï¼Œ`T` ä¸ºæ³›å‹ç±»å‹ï¼Œå¯ä»¥æŒ‡ä»£ä»»ä½•ç±»å‹ã€‚`None` åˆ™è¡¨ç¤ºæ²¡æœ‰å€¼ã€‚

`Option<T>` æšä¸¾è¢«åŒ…å«åœ¨ `prelude` åº“ä¸­ï¼Œä¸¤ä¸ªæˆå‘˜ä¹Ÿåœ¨åº“ä¸­ã€‚

> `prelude` æ˜¯ Rust æ ‡å‡†åº“ï¼ŒåŒ…å«æœ€å¸¸ç”¨çš„ç±»å‹å’Œå‡½æ•°ç­‰ï¼Œè‡ªåŠ¨è¢«å¼•å…¥ã€‚

```rust
let some_num = Some(5);
let absent_num: Option<i32> = None;
```

ä½¿ç”¨ `None` æ—¶å¿…é¡»æ‰‹åŠ¨å£°æ˜ç±»å‹ï¼Œå› ä¸ºç¼–è¯‘å™¨æ— æ³•é€šè¿‡ `None` æ¨æ–­ `Some` ä¸­çš„ç±»å‹ã€‚

ä¸ºäº†åˆ›å»ºä¸€ä¸ªå¯èƒ½çš„ç©ºå€¼ï¼Œå¿…é¡»æ˜¾å¼åœ°æ”¾å…¥ `Option<T>` ä¸­ï¼Œéšåï¼Œä½¿ç”¨æ—¶å¿…é¡»æ˜ç¡®åœ°å¤„ç†å…¶ä¸ºç©ºçš„æƒ…å†µï¼Œå¦åˆ™æ— æ³•è¿‡ç¼–ï¼Œè¿™å°±æ˜¯ `Option<T>` ä¿è¯å®‰å…¨æ€§çš„æœºåˆ¶ã€‚

## æ•°ç»„

æ•°ç»„ `array`ï¼ŒåŠ¨æ€æ•°ç»„ `Vector`ã€‚

```rust
// åˆ›å»ºæ•°ç»„
let a = [1, 2, 3];
let b: [i32; 3] = [8, 6, 4];
let c = [6; 4]; // 4 ä¸ª 6, [6, 6, 6, 6]

// äºŒç»´æ•°ç»„
let d: [[i32; 3]; 2] = [a, b];

// è®¿é—®å…ƒç´ 
let a0 = a[0]; // 1

// åˆ›å»ºå…ƒç´ ä¸ºéåŸºæœ¬ç±»å‹çš„æ•°ç»„
let strs: [String; 8] = std::array::from_fn(|s| String::from("Rust"));

// åˆ‡ç‰‡
let slice: &[i32] = &a[1..3];

// å€Ÿç”¨å…ƒç´ 
for arr in d {
	for x in arr {
		println!("{x}");
	}
	
	let mut sum = 0;
	for i in 0..arr.len() {
		sum += a[i];
	}
	println!("{sum}");
}
```

ğŸ‘‰ [[4 æµç¨‹æ§åˆ¶]]