### 多级指针

二级指针：int\*\* pnn，它是int\*类型数据对象的指针。

![[20-1.png|450]]

多级指针同理，**几级指针就有几个取值运算符**。

### 指针数组

int\* p\[10\]：有10个int\*类型元素的指针数组。

![[20-2.png|300]]

![[20-3.png|450]]

### 从函数中返回指针

```c
#include <stdio.h>

int* func()
{
	int n = 100;
	return &n;
}

int main()
{
	int* p = func();
	printf("%d\n", *p);
	return 0;
}
```

这段代码看似正确，但实际上==变量n在函数结束后被系统回收，因此已经失效==，最终打印的值可能正确也可能无意义，取决于该地址的数据是否被覆写。

**关键词static**：如果想让某个变量从声明到运行结束的过程中一直存在，可以在声明前加关键词static，这样就声明了一个静态变量。

```c
static int n = 100;
```

### 从函数中返回多个变量

要返回多个变量，可以将==指针作为参数==传递到函数中。

要返回多个指针变量，可以将==二级指针作为参数==传递到函数中。

```c
#include <stdio.h>

#define NULL 0

void func(int** a, int** b)
{
	static int x = 100;
	static int y = 200;
	*a = &x;
	*b = &y;
}

int main()
{
	int* a = NULL;
	int* b = NULL;
	//将指针初始化为0是一个好习惯
	func(&a, &b);
	if (a != NULL && b != NULL)
		printf("a=%d b=%d\n", *a, *b);
	return 0;
}
```

### 多维数组与指针

```c
int A[10];
int B[5][10];
```

现定义了两个数组，想要对它们分别再定义一个指针。

类比二维数组的定义方法：元素类型 数组名\[元素个数\]，可以写出**二维数组指针**（注意这是“指针”，而**指针数组**（见上文）是“数组”）的定义方法：目标类型* 变量名\[元素个数\]。

但是按照这个方法写出数组B的指针pB的定义：int\* pB\[10\]，会被误认为是元素类型为int*，含有10个元素的指针数组pB。

为了区分开，需要**在声明中添加括号**，如下：

```c
int* pA = A;
int (*pB)[10] = B;
```

### 数组指针移动和取值

![[20-4.png|450]]

定义了一个二维数组B，并定义它的数组指针pInt10。

pInt10 + 0/1/2/3/4 分别指向数组B的第1/2/3/4/5个数组元素。

![[20-5.png|450]]

用sizeof查看不同类型数据的空间大小：
- 二维数组B，有50个int元素，占用50\*4=200个字节。
- 数组B的指针pInt10，是一个指针，占用4个字节。
- int\[10\]类型数组\*pInt10，是一个数组（B的一个子数组），占用10\*4=40个字节。

![[20-6.png|450]]

定义一个目标数据类型为int的指针pInt，并用\*pInt10初始化。

![[20-7.png|450]]

![[20-8.png|450]]

这两个指针移动的规律：pInt10每次+1都会移动数组B的外层，一共能指向5个子数组的首个元素；pInt每次+1都会移动数组B的内层，一共能指向50个元素。

![[20-9.png|450]]

对pInt再进行取值运算，就能获取B中各个元素的值。

### 指针访问与下标访问

![[20-10.png|300]]

有两种方法访问数组内的元素，如访问A[10]的第2个元素，可以写作A[1]，也可以写作*(A + 1)"。

下标运算符(\[\])的优先级高于一切其它的运算符。

使用数组名时，程序会将数组名转换成指向首元素的指针再进行运算，因此以下写法更加通用：

![[20-11.png|300]]

因此，上上上图还可以写作：

![[20-12.png|450]]

甚至：

![[20-13.png|300]]

### 对数组取地址

前面提到了数组名的转换规则：

![[20-14.png|300]]

现在来看第二种情况：

![[20-15.png|450]]

![[20-16.png|450]]

对int取地址，为int (\*)类型的指针；对int\[10\]取地址，为int (\*)\[10\]类型的指针。

所以pInt10是int (\*)\[10\]类型的指针，步长为40。

再对pInt10取地址，类型为int (\*\*)\[10\]类型的指针。

### 指针访问三维数组元素

初始化一个三维数组int P\[2\]\[5\]\[10\]，访问第2个二维数组的第3个一维数组的第4个元素，有以下两种写法：P\[1\]\[2\]\[3\]、\*(\*(\*(P + 1) + 2) + 3)。

![[20-17.png|450]]