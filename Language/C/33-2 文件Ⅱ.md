### 写入文件

#### fputc：向文件中写入一个字符

![[33-2-1.png|450]]

![[33-2-2.png|450]]

追加模式"a"（append）：不清空原有内容，而在原有内容之后继续写入。

#### fputs：向文件中写入一个字符串

![[33-2-3.png|450]]

![[33-2-4.png|450]]

#### fflush：主动刷新缓存

现在改写程序，让程序结束前先暂停、按下任意键后再结束：

![[33-2-5.png|300]]

运行程序，按下任意键前已经执行过fputs函数了，但是查看文件内容仍为空。

这是因为写入文件的过程也存在缓存区，将缓存区的内容写入文件称为刷新缓存，触发条件有如下3种：

![[33-2-6.png|300]]

![[33-2-7.png|300]]

### 文件偏移

用函数fgetc、fgets读取文件内容的原理：

文件结构pFile中保存了一个当前文件读写位置的指针，文件由fopen打开之后，==这个指针指向文件内容的第一个字节，当任意函数操作文件读写相应的长度之后，指针也会偏移相应长度==。

函数fgetc每次获取一个指针，所以指针每次向后偏移1个字节，因此==重复调用fgetc可以逐个读取文件内容的字符==。

函数fgets每次获取一行字符，因此==重复调用fgets可以逐行读取文件内容的字符==。

#### fseek：移动文件指针

![[33-2-8.png|450]]

![[33-2-9.png|450]]

![[33-2-10.png|450]]

![[33-2-11.png|450]]

#### ftell：获取当前的文件指针位置

![[33-2-12.png|450]]

先用函数fseek将文件指针偏移到文件末尾，再用ftell获取指针位置，就可以获取文件的大小。

![[33-2-13.png|450]]

![[33-2-14.png|450]]

#### rewind：将文件指针回到文件开头

![[33-2-15.png|300]]

### 更新文件

需求：将文件中的H全部替换为h。

r模式无法写入，w模式会清空文件，a模式无法更改原有内容。

两个文件更新模式：w+、r+。

![[33-2-16.png|450]]

修改核心：

![[33-2-17.png|450]]

注意：读取到H时指针已经移动到下一个字符，所以==在修改前需要把指针向前移动一个字符==。

---

读写操作转换时的特别注意：

![[33-2-18.png|450]]

前两行：转换之前必须进行的操作。

最后一行：如果只需要转换而不需要偏移文件指针，可以偏移0字节。

上例代码中的读写转换时就调用了fseek：

![[33-2-19.png|450]]