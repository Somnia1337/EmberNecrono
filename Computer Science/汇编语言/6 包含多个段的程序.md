ğŸ‘ˆ [[5 BX å’Œ loop æŒ‡ä»¤]]

ç¨‹åºå–å¾—æ‰€éœ€çš„ç©ºé—´æœ‰ä¸¤ç§æ–¹æ³•ï¼š

- åŠ è½½æ—¶åˆ†é…
- è¿è¡Œæ—¶ç”³è¯·ï¼ˆä¸è®¨è®ºï¼‰

è¦åœ¨åŠ è½½æ—¶åˆ†é…ç©ºé—´ï¼Œéœ€å®šä¹‰ä¸€ä¸ªæ®µï¼Œäº§ç”Ÿäº†å¤šä¸ªæ®µçš„ç¨‹åºã€‚

### åœ¨ä»£ç æ®µä¸­ä½¿ç”¨æ•°æ®

å¯¹ä»¥ä¸‹ 8 ä¸ªæ•°æ®æ±‚å’Œï¼Œç»“æœå­˜å‚¨åœ¨ AX ä¸­ï¼š

```text
0123H, 0456H, 0789H, 0ABCH, 0DEFH, 0FEDH, 0CBAH, 0987H
```

æœ‰å¤šä¸ªæ•°æ®ï¼Œæœ€å¥½ç”¨ `loop` ç´¯åŠ ï¼Œå°±éœ€è¦å­˜å‚¨åœ¨ä¸€ç»„åœ°å€è¿ç»­çš„å†…å­˜å•å…ƒä¸­ï¼Œå› æ­¤éœ€è¦å‘ OS ç”³è¯·å†…å­˜ã€‚

åœ¨ç¨‹åºä¸­å®šä¹‰è¿™ç»„æ•°æ®ï¼Œæ‰§è¡Œç¨‹åºæ—¶å®ƒä»¬éšä¹‹è¢«åŠ è½½åˆ°å†…å­˜ï¼Œè‡ªç„¶è·å–äº†ç©ºé—´ï¼š

```asmatmel
assume cs:code

code segment
	dw 0123H, 0456H, 0789H, 0ABCH, 0DEFH, 0FEDH, 0CBAH, 0987H
	
	mov bx, 0
	mov ax, 0
	
	mov cx, 8
s:  add ax, cs:[bx]
	add bx, 2
	loop s
	
	mov ax, 4C00H
	int 21H
code ends

end
```

ä»£ç æ®µçš„é¦–è¡Œ `dw`(define word) å®šä¹‰äº† 8 ä¸ªå­—å‹æ•°æ®ï¼Œå®ƒä»¬çš„æ®µåœ°å€ä¸ç¨‹åºç›¸åŒã€å­˜å‚¨åœ¨ CS ä¸­ï¼Œç”±äºæ˜¯ç¬¬ä¸€å¥ã€åç§»åœ°å€ä¸º 0ï¼Œå› æ­¤å®ƒä»¬çš„åœ°å€ä¸º `cs:0` ~ `cs:E`ã€‚

![[Snipaste_240318_141457.png|500]]

![[Snipaste_240318_142118.png|500]]

è¿æ¥æˆ `.exe` åï¼Œéœ€è¦åœ¨ Debug ä¸­æ‰‹åŠ¨è®¾ç½® IP = `0010`ï¼Œä»¥æŒ‡å®šç¨‹åºçš„å…¥å£è¯­å¥ `mov bx, 0`ï¼Œå¦‚æœä¸è¿™æ ·åšï¼Œç¨‹åºæ‰§è¡Œå°†ä¸ä¼šå¾—åˆ°ç›®æ ‡ç»“æœã€‚

æ”¹è¿›ç¨‹åºï¼Œä½¿å¾—è¿æ¥äº§ç”Ÿçš„ `.exe` å¯ä»¥ç›´æ¥æ‰§è¡Œï¼š

```asmatmel
assume cs:code

code segment
	dw 0123H, 0456H, 0789H, 0ABCH, 0DEFH, 0FEDH, 0CBAH, 0987H
	
start:  mov bx, 0
		mov ax, 0
		
		mov cx, 8
s:      add ax, cs:[bx]
		add bx, 2
		loop s
		
		mov ax, 4C00H
		int 21H
code ends

end start
```

åœ¨ç¬¬ä¸€å¥å‰ä½¿ç”¨æ ‡å· `start` æŒ‡æ˜ç¨‹åºçš„å…¥å£ï¼Œå¹¶å°†æœ«è¡Œ `end` æ”¹ä¸º `end start`ã€‚

å«æ•°æ®ç¨‹åºçš„æ¡†æ¶ï¼š

```asmatmel
assume cs:code

code segment
	; æ•°æ®

start:
	; ä»£ç 

code ends

end start
```

### åœ¨ä»£ç æ®µä¸­ä½¿ç”¨æ ˆ

è¡¥å…¨ç¨‹åºï¼Œç”¨æ ˆå°†ç¨‹åºæ•°æ®å€’åºå­˜æ”¾ï¼š

```asmatmel
assume cs:code

codesg segment
	dw 0123H, 0456H, 0789H, 0ABCH, 0DEFH, 0FEDH, 0CBAH, 0987H
	
	; todo

codesg ends

end
```

æ€è·¯ï¼šå°†æ•°æ®å­˜æ”¾åœ¨ä¸€ç³»åˆ—å­—å•å…ƒï¼ˆ`cs:0` ~ `cs:F`ï¼‰ä¸­ï¼Œä¾æ¬¡å…¥æ ˆï¼ˆæ ˆæ®µä¸º `cs:10` ~ `cs:2F`ï¼‰ï¼Œå†ä¾æ¬¡å‡ºæ ˆåˆ°ç›¸åŒä½ç½®ã€‚

```asmatmel
assume cs:code

codesg segment
	dw 0123H, 0456H, 0789H, 0ABCH, 0DEFH, 0FEDH, 0CBAH, 0987H
	dw 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
	; å®šä¹‰ 16 ä¸ªå­—å‹æ•°æ®, ä»è€Œå–å¾—ç›¸åº”çš„ç©ºé—´, ä»¥ä½œä¸ºæ ˆæ®µä½¿ç”¨
	
start:  mov ax, cs
		mov ss, ax
		mov sp, 30H
		
		mov bx, 0
		mov cx, 8
s:      push cs:[bx]
		add bx, 2
		loop s ; å…¥æ ˆ
		
		mov bx, 0
		mov cx, 8
s0:     pop cs:[bx]
		add bx, 2
		loop s0 ; å‡ºæ ˆ
		
		mov ax, 4C00H
		int 21H
codesg ends

end start
```

æ ˆæ®µä¸º `cs:10` ~ `cs:2F`ï¼Œåˆå§‹æ—¶æ ˆç©ºï¼Œéœ€è®¾ç½® `ss:sp` æŒ‡å‘æ ˆåº•ï¼Œå› æ­¤è®¾ç½® SS:SP = `cs:30`ã€‚

### å°†æ•°æ®ã€ä»£ç ã€æ ˆæ”¾å…¥ä¸åŒçš„æ®µ

ç±»ä¼¼äºå®šä¹‰ä»£ç æ®µï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç¨‹åºä¸­å®šä¹‰å¤šä¸ªæ®µï¼š

```asmatmel
assume cs:code, ds:data, ss:stack

data segment
	dw 0123H, 0456H, 0789H, 0ABCH, 0DEFH, 0FEDH, 0CBAH, 0987H
data ends

stack segment
	dw 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
stack ends

code segment
start:  mov ax, stack
		mov ss, ax
		mov sp, 20H
		
		mov ax, data
		mov ds, ax
		mov bx, 0
		
		mov cx, 8
s:      push [bx]
		add bx, 2
		loop s
		
		mov bx, 0
		
		mov cx, 8
s0:     pop [bx]
		add bx, 2
		loop s0
		
		mov ax, 4C00H
		int 21H
code ends
end start
```

æ®µåä¼šè¢«ç¼–è¯‘å™¨æ›¿æ¢ä¸ºæ®µåœ°å€ï¼Œ`mov ax, data` å°†æ®µåä¸º `data` çš„æ®µï¼ˆæ•°æ®æ®µï¼‰çš„æ®µåœ°å€å­˜å…¥ AXã€‚

æ•°æ®æ®µä¸­çš„æ•°æ® `0ABCH` çš„åœ°å€ä¸º `data:6`ï¼Œè¦å°†å…¶å­˜å…¥ BXï¼š

```asmatmel
mov ax, data
mov ds, ax
mov bx, ds:[6]
```

ä¸èƒ½ä½¿ç”¨ï¼š

```asmatmel
mov ds, data ; error: ä¸èƒ½å°†å€¼ç›´æ¥å­˜å…¥æ®µå¯„å­˜å™¨
mov bx, ds:[6]
```

æ›´ä¸èƒ½ä½¿ç”¨ï¼š

```asmatmel
mov bx, data:[6] ; error: è¿™ç§æ ¼å¼çš„ `:` å‰éœ€ä¸ºæ®µå¯„å­˜å™¨
```

ğŸ‘‰ [[7 æ›´çµæ´»çš„å®šä½å†…å­˜åœ°å€çš„æ–¹æ³•]]