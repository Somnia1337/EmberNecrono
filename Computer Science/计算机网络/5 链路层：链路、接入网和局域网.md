👈 [[4 网络层]]

## 链路层概述

**结点**：运行 *链路层协议* 的任何设备。

**链路**：沿着通信路径连接相邻结点的通信信道。

### 链路层提供的服务

- 成帧
- 链路接入：**介质访问控制**(MAC) 规定了帧在链路上传输的规则
- 可靠交付
- 差错检测和纠正

### 链路层在何处实现

链路层的主体部分在 **网络适配器**/**网络接口卡** 中实现。

## 差错检测和纠正技术

### 奇偶校验

设实际数据有 $d$ bit，*偶校验* 要附加额外的 $1$ 比特，使 $d + 1$ 比特中 `1` 的数量为偶，*奇校验* 则要使其数量为奇。

*二维奇偶校验* 还能定位单个错误的比特。

### 检验和方法

将数据的字节视为 $16$ bit 的整数，求和后取反码，作为检验和。

### 循环冗余检测

**循环冗余检测**(CRC) 编码：设要发送数据 $D$，双方事先商定一个 $r + 1$ bit 的 **生成多项式** $G$（要求最高位为 `1`），发送方在 $D$ 的末端附加一个 $r$ bit 的 **CRC 比特** $R$ 作为实际发送的数据 $D^\prime$，接收方计算 $D^\prime \space {\rm mod} \space G$，当且仅当结果为 $0$ 时认为传输无误。

$R$ 的计算：$$R = D \cdot 2^r \space {\rm mod} \space G$$

在计算 $R$ 的过程中，所有二进制位运算使用异或 `^` 且无进位和借位，与常规位运算不同的算式：

- $1 + 1 = 0$
- $0 - 1 = 1$

*CRC* 能够测出所有连续 $r$ bit 或更少的差错。

## 多路访问链路和协议

多路访问协议能够划分为 3 类：

| 类别     | 协议                                                              |
| ------ | --------------------------------------------------------------- |
| 信道划分协议 | 时分多路复用<br>频分多路复用<br>码分多址                                        |
| 随机接入协议 | 时隙 ALOHA<br>纯 ALOHA<br>载波侦听多路访问 CSMA<br>具有碰撞检测的载波侦听多路访问 CSMA/CD |
| 轮流协议   | 轮询<br>令牌传递                                                      |

## 交换局域网

### 链路层寻址和 ARP

#### MAC 地址

主机和路由器的适配器（网络接口）具有一个 *网络层的* *IP 地址* 和一个 *链路层的* **LAN 地址**/**物理地址**/**MAC 地址**。

*MAC 地址* 与 *IP 地址* 的比较：

| 比较项  | IP 地址                                                                                                 | MAC 地址              |
| ---- | ----------------------------------------------------------------------------------------------------- | ------------------- |
| 组织结构 | 层次结构                                                                                                  | 扁平结构                |
| 变化性  | 随设备在网络中的移动而改变                                                                                         | 出厂后即不改变             |
| 广播地址 | IPv4：`255.255.255.255`<br>IPv6 取消了广播，改用 [多播](https://baike.baidu.com/item/%E5%A4%9A%E6%92%AD/6867723) | `FF-FF-FF-FF-FF-FF` |
| 地址长度 | IPv4：$32$ bit<br>IPv6：$128$ bit                                                                       | $48$ bit            |
| 格式   | IPv4：`.` 分十进制<br>IPv6：`:` 分十六进制                                                                       | `-` 分十六进制           |

#### 地址解析协议

**地址解析协议**(ARP) 负责将 IP 地址转换为 MAC 地址。

ARP 和 DNS 解析的比较：

- DNS 将主机名解析为 IP 地址，ARP 将 IP 地址解析为 MAC 地址
- DNS 为因特网中的任何主机工作，ARP 只为同一子网中的主机工作

*ARP 查询分组* 的目的地址为 *MAC 广播地址* `FF-FF-FF-FF-FF-FF`，而 *响应分组* 的目的地址为发起查询的主机。

一个可能的 ARP 表：

| IP 地址             | MAC 地址              | TTL      |
| ----------------- | ------------------- | -------- |
| `222.222.222.221` | `88-B2-2F-54-1A-0F` | 13:45:00 |
| `222.222.222.223` | `5C-66-AB-90-75-B1` | 13:52:00 |

ARP 表是自动建立的，无需管理员手动配置。

#### 发送数据报到子网以外

发送的过程中，目标 IP 地址不变，但目标 MAC 地址在每个子网中都不同。

### 以太网

#### 以太网的 3 个发展阶段

##### 总线结构

##### 物理（拓扑）星形、逻辑（实际）总线结构

中心为基于 **集线器**(hub)，作用于比特，将到达比特放大后输出到所有接口

##### 星形结构

将 *集线器* 替换为 *交换机*，当其收到来自接口 $x$ 的报文时，检查其表项——

- 无对应表项 => *洪泛*：广播给除 $x$ 外的所有接口
- 对应目标接口为 $y$ =>
	- $y = x$ => *过滤*：忽略并丢弃
	- $y \neq x$ => *转发*：转发到接口 $y$

![[以太网的吞吐量.png|400]]